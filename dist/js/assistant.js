const Assistant=function(){"use strict";function e(e,n,s,r){let i=10*(e.editorialScores?.overall||5);const c=[],a=[];if(n.forEach(n=>{const u=s[n.id];if(null==u||""===u)return;const l=function(e,o){if("number"===e.type)return e.scoring;if(e.options){const t=e.options.find(e=>e.value===o);return t?.scoring||null}return e.scoring||null}(n,u);if(l){if("fit_check"===l.rule&&"number"==typeof u){const t=o(e,l.field);if(t){const e=l.gap||0;u>=t+e?(i+=10,c.push(`Cabe no seu espaço de ${u} cm`)):(i+=l.penaltyIfNotFit||-100,a.push(`Não cabe no espaço de ${u} cm (precisa ${t+e} cm)`))}}if("budget_check"===l.rule&&"number"==typeof u){const o=e.bestPrice;if(o)if(o>u)i+=l.penaltyIfOver||-50,a.push(`Acima do orçamento (${t(o)} > ${t(u)})`);else{i+=5;const e=u-o;e>200&&c.push(`${t(e)} abaixo do orçamento`)}}if(l.boost_topic){const o=e.editorialScores?.[l.boost_topic]||5,t=o*(l.factor||1);if(i+=t,o>=8){const e=r.scoringTopics.find(e=>e.id===l.boost_topic)?.label;c.push(`Destaque em ${e?.toLowerCase()||l.boost_topic}`)}}if(l.boost_field){const t=o(e,l.boost_field);"number"==typeof t&&(i+=t*(l.factor||.1))}if(l.penalty_field){const t=o(e,l.penalty_field);"number"==typeof t&&(i+=t*(l.factor||-.1))}if(l.boost_field_inverse){const t=o(e,l.boost_field_inverse);"number"==typeof t&&t>0&&(i+=1/t*(l.factor||1)*1e4)}}}),e.bestPrice){const o=Object.values(r.products).filter(e=>e.bestPrice).map(e=>e.bestPrice);e.bestPrice===Math.min(...o)&&c.push(`Menor preço: ${t(e.bestPrice)}`)}return(e.idealFor||[]).slice(0,2).forEach(e=>{c.some(o=>o.includes(e.label))||c.push(e.label)}),{score:i,reasons:c.slice(0,3),warnings:a}}function o(e,o){if(e&&o)return o.split(".").reduce((e,o)=>e?.[o],e)}function t(e){return null==e?"N/A":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)}return{loadConfig:async function(e){const o=await fetch(`/data/assistant/${e}.json`);if(!o.ok)throw new Error(`Assistant config not found: ${e}`);return o.json()},getRecommendations:function(o,t,n){const s=Object.values(o.products).filter(e=>"active"===e.status).map(s=>{const{score:r,reasons:i,warnings:c}=e(s,t.questions,n,o);return{product:s,score:r,reasons:i,warnings:c}});s.sort((e,o)=>o.score-e.score);const r=t.resultConfig?.showTop||3,i=s.slice(0,r);return i.length>0&&(i[0].isWinner=!0),{recommendations:i,alternatives:t.resultConfig?.showAlternatives?s.slice(r,r+(t.resultConfig?.maxAlternatives||2)):[],answersUsed:n,generatedAt:(new Date).toISOString()}},getComparisonQuestions:function(e,o,t){const n=t.map(o=>e.products[o]).filter(Boolean);if(n.length<2)return o.questions;const s=function(e){const o=[];["largura_cm","capacidade_freezer","consumo_kwh","capacidade_total"].forEach(t=>{const n=e.map(e=>e.specs?.[t]).filter(e=>null!=e);n.length>=2&&(Math.max(...n)-Math.min(...n))/(n.reduce((e,o)=>e+o,0)/n.length)>.1&&o.push(t)}),["ruido","consumo","funcionalidades","encaixe"].forEach(t=>{const n=e.map(e=>e.editorialScores?.[t]).filter(e=>null!=e);n.length>=2&&Math.max(...n)-Math.min(...n)>=1.5&&o.push(t)});const t=new Set;return e.forEach(e=>(e.features||[]).forEach(e=>t.add(e.id))),t.forEach(t=>{const n=e.map(e=>!0===(e.features||[]).find(e=>e.id===t)?.value);n.some(e=>e)&&n.some(e=>!e)&&o.push(t)}),o}(n),r=o.questions.filter(e=>"niche_width"===e.id||"budget"===e.id||!(!e.scoring?.field||!s.some(o=>e.scoring.field.includes(o)))||!!e.options&&e.options.some(e=>!!(e.scoring&&(e.scoring.boost_topic&&s.includes(e.scoring.boost_topic)||e.scoring.boost_field&&s.some(o=>e.scoring.boost_field.includes(o))))));return r.length>=2?r:o.questions},recommendFromComparison:function(o,t,n,s){const r=n.map(e=>o.products[e]).filter(Boolean).map(n=>{const{score:r,reasons:i,warnings:c}=e(n,t.questions,s,o);return{product:n,score:r,reasons:i,warnings:c}});r.sort((e,o)=>o.score-e.score);const i=r[0],c=r[1];return{winner:i?{...i,isWinner:!0,margin:c?Math.round(10*(i.score-c.score))/10:null}:null,others:r.slice(1),answersUsed:s,generatedAt:(new Date).toISOString()}},calculateScore:e}}();"undefined"!=typeof module&&module.exports&&(module.exports=Assistant);
const Comparator=function(){"use strict";function e(e,t){const o={},n=e[0];return n.specs?(Object.keys(n.specs).forEach(n=>{const l=t?.[n]||{},a=e.map(e=>({productId:e.id,productName:e.name,value:e.specs[n],formatted:r(e.specs[n],l)})),i=function(e,r){const t=e.filter(e=>"number"==typeof e.value);if(t.length<2)return null;if(null==r)return null;const o=[...t].sort((e,t)=>r?t.value-e.value:e.value-t.value);return o[0].value===o[1].value?null:o[0]}(a,l.higherIsBetter);o[n]={key:n,label:l.label||n,unit:l.unit,higherIsBetter:l.higherIsBetter,values:a,winnerId:i?.productId||null,isDraw:null===i}}),o):o}function r(e,r){return null==e?"N/A":"boolean"==typeof e?e?"Sim":"NÃ£o":Array.isArray(e)?e.join(", "):"number"==typeof e&&r?.unit?`${e.toLocaleString("pt-BR")} ${r.unit}`:String(e)}function t(e,r){const t={};r.forEach(r=>{const o=e.map(e=>({productId:e.id,productName:e.name,score:e.editorialScores?.[r.id]??null})),n=o.filter(e=>null!==e.score);let l=null;if(n.length>=2){const e=[...n].sort((e,r)=>r.score-e.score);e[0].score!==e[1].score&&(l=e[0])}t[r.id]={topic:r.id,label:r.label,icon:r.icon,values:o,winnerId:l?.productId||null,isDraw:n.length>=2&&null===l}});const o=e.map(e=>({productId:e.id,productName:e.name,score:e.editorialScores?.overall??null})),n=o.filter(e=>null!==e.score);let l=null;if(n.length>=2){const e=[...n].sort((e,r)=>r.score-e.score);e[0].score!==e[1].score&&(l=e[0])}return t.overall={topic:"overall",label:"Nota Geral",icon:"ðŸ†",values:o,winnerId:l?.productId||null,isDraw:n.length>=2&&null===l},t}function o(e){const r=new Set;e.forEach(e=>{(e.features||[]).forEach(e=>r.add(e.id))});const t=[];return r.forEach(r=>{const o=e.map(e=>{const t=(e.features||[]).find(e=>e.id===r);return{productId:e.id,productName:e.name,has:!0===t?.value,label:t?.label||r}}),n=o.map(e=>e.has);n.every(e=>e===n[0])||t.push({featureId:r,label:o.find(e=>e.label)?.label||r,values:o,winnerId:o.find(e=>e.has)?.productId||null})}),t}function n(e){const r=e.map(e=>{return{productId:e.id,productName:e.name,bestPrice:e.bestPrice,bestOffer:e.bestOffer,formatted:e.bestPrice?(r=e.bestPrice,null==r?"N/A":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r)):"N/A"};var r}),t=r.filter(e=>null!==e.bestPrice);let o=null;return t.length>=2&&(o=[...t].sort((e,r)=>e.bestPrice-r.bestPrice)[0]),{values:r,cheapestId:o?.productId||null,priceDifference:t.length>=2?Math.abs(t[0].bestPrice-t[1].bestPrice):null}}function l(e){return e.map(e=>({productId:e.id,productName:e.name,sentiment:e.voc?.sentiment||"Desconhecido",sentimentClass:e.voc?.sentimentClass||"neutral",oneLiner:e.voc?.oneLiner||null,topPro:e.voc?.pros?.[0]||null,topCon:e.voc?.cons?.[0]||null,sampleSize:e.voc?.sample?.totalApprox||null}))}function a(e){const r=[...e].filter(e=>null!=e.editorialScores?.overall).sort((e,r)=>r.editorialScores.overall-e.editorialScores.overall);return r.length<2||r[0].editorialScores.overall===r[1].editorialScores.overall?null:{productId:r[0].id,productName:r[0].name,score:r[0].editorialScores.overall,margin:Math.round(10*(r[0].editorialScores.overall-r[1].editorialScores.overall))/10}}function i(e,r){const t=[],o=e.map(e=>e.specs?.largura_cm).filter(Boolean);if(o.length>=2){const e=Math.max(...o)-Math.min(...o);e>=5&&t.push({type:"spec",field:"largura_cm",label:"Largura",icon:"ðŸ“",description:`DiferenÃ§a de ${e.toFixed(1)} cm na largura`})}const n=e.map(e=>e.specs?.capacidade_freezer).filter(Boolean);if(n.length>=2){const e=Math.max(...n)-Math.min(...n);e>=20&&t.push({type:"spec",field:"capacidade_freezer",label:"Freezer",icon:"â„ï¸",description:`DiferenÃ§a de ${e}L no freezer`})}const l=e.map(e=>e.specs?.consumo_kwh).filter(Boolean);if(l.length>=2){const e=Math.max(...l)-Math.min(...l);e>=3&&t.push({type:"spec",field:"consumo_kwh",label:"Consumo",icon:"âš¡",description:`DiferenÃ§a de ${e.toFixed(1)} kWh/mÃªs`})}const a=e.map(e=>(e.features||[]).find(e=>"painel_digital"===e.id)?.value);return a.some(e=>!0===e)&&a.some(e=>!0!==e)&&t.push({type:"feature",field:"painel_digital",label:"Painel Digital",icon:"ðŸ“±",description:"Nem todos tÃªm painel digital"}),t}return{compare:function(r,c){if(!c||c.length<2)throw new Error("MÃ­nimo 2 produtos para comparar");if(c.length>5)throw new Error("MÃ¡ximo 5 produtos para comparar");const s=c.map(e=>r.products[e]).filter(Boolean);if(s.length<2)throw new Error("Produtos nÃ£o encontrados");return{products:s,productCount:s.length,specComparison:e(s,r.specDefinitions),editorialComparison:t(s,r.scoringTopics),featureComparison:o(s),priceComparison:n(s),vocSummary:l(s),overallWinner:a(s),keyDifferences:i(s),generatedAt:(new Date).toISOString()}},generateUrl:function(e,r){const t=[...r].sort();return 2===t.length?`/${e}/${t[0]}-vs-${t[1]}/`:`/${e}/comparar/?p=${t.join(",")}`},parseUrl:function(e){const r=e.match(/\/comparar\/\?p=(.+)/);if(r)return r[1].split(",").filter(Boolean);const t=e.match(/\/([a-z0-9-]+)-vs-([a-z0-9-]+)\/?$/);return t?[t[1],t[2]]:[]},MIN_PRODUCTS:2,MAX_PRODUCTS:5}}();"undefined"!=typeof module&&module.exports&&(module.exports=Comparator);
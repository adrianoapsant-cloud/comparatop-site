<!DOCTYPE html>
<!-- Build: 2025-12-26T22:02 -->
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <script>
        /**
         * Debugging Nuclear Console (Head snippet)
         * Ativa com ?debug=1  (ou localStorage.DEBUG_CONSOLE=1)
         */
        (function () {
            var ENABLE = /(?:\?|&)debug=1(?:&|$)/.test(location.search) || localStorage.getItem("DEBUG_CONSOLE") === "1";
            var buf = []; var maxLines = 200;
            function now() { try { return new Date().toISOString().replace('T', ' ').replace('Z', ''); } catch (e) { return ''; } }
            function push(line) { buf.push(line); if (buf.length > maxLines) buf.shift(); if (ENABLE && window.__dbg && window.__dbg.print) window.__dbg.print(line); }
            function safeStr(x) { try { if (x instanceof Error) return (x.name + ": " + x.message + (x.stack ? "\n" + x.stack : "")); if (typeof x === "string") return x; return JSON.stringify(x); } catch (e) { try { return String(x); } catch (e2) { return "[unprintable]"; } } }
            window.addEventListener("error", function (e) { push("[" + now() + "][window.error] " + (e.message || "Error") + " @ " + (e.filename || "?") + ":" + (e.lineno || "?")); if (e.error) push(safeStr(e.error)); });
            window.addEventListener("unhandledrejection", function (e) { push("[" + now() + "][unhandledrejection] " + safeStr(e.reason)); });
            (function () {
                var orig = { log: console.log, info: console.info, warn: console.warn, error: console.error };
                ["log", "info", "warn", "error"].forEach(function (k) { console[k] = function () { var args = Array.prototype.slice.call(arguments).map(safeStr).join(" "); push("[" + now() + "][console." + k + "] " + args); try { orig[k].apply(console, arguments); } catch (e) { } }; });
            })();
            function logPointer(ev) { try { var t = ev.target; var cls = (t && t.className) ? ("" + t.className).toString().replace(/\s+/g, ".") : ""; var tag = (t && t.tagName) ? t.tagName.toLowerCase() : "unknown"; push("[" + now() + "][" + ev.type + "] target=" + tag + (cls ? ("." + cls) : "")); } catch (e) { } }
            document.addEventListener("click", logPointer, true);
            function initUI() {
                if (!ENABLE) return;
                var wrap = document.createElement("div"); wrap.id = "__dbg_console";
                wrap.style.cssText = "position:fixed;top:0;left:0;right:0;z-index:2147483647;font:10px monospace;background:rgba(0,0,0,.9);color:#fff;padding:8px;max-height:40vh;overflow:auto;pointer-events:none;";
                var pre = document.createElement("pre"); pre.style.cssText = "white-space:pre-wrap;margin:0";
                wrap.appendChild(pre);
                window.__dbg = { print: function (line) { pre.textContent += line + "\n"; wrap.scrollTop = wrap.scrollHeight; } };
                buf.forEach(function (l) { window.__dbg.print(l); });
                document.documentElement.appendChild(wrap);
            }
            if (document.readyState === "loading") document.addEventListener("DOMContentLoaded", initUI); else initUI();
        })();
    </script>
    
    <title>Geladeira Samsung Evolution RT46 com POWERvolt Inverter Duplex 460L - Review e Preços | ComparaTop</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Análise completa do Geladeira Samsung Evolution RT46 com POWERvolt Inverter Duplex 460L. Compare preços, veja especificações e opiniões reais de compradores.">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://comparatop.com.br/produto/geladeira/samsung-rt46/">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="product">
    <meta property="og:url" content="https://comparatop.com.br/produto/geladeira/samsung-rt46/">
    <meta property="og:title" content="Geladeira Samsung Evolution RT46 com POWERvolt Inverter Duplex 460L - Review e Preços | ComparaTop">
    <meta property="og:description" content="Análise completa do Geladeira Samsung Evolution RT46 com POWERvolt Inverter Duplex 460L. Compare preços, veja especificações e opiniões reais de compradores.">
    <meta property="og:image" content="https://img.comparatop.com.br/assets/og-image.png">
    
    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Geladeira Samsung Evolution RT46 com POWERvolt Inverter Duplex 460L - Review e Preços | ComparaTop">
    <meta name="twitter:description" content="Análise completa do Geladeira Samsung Evolution RT46 com POWERvolt Inverter Duplex 460L. Compare preços, veja especificações e opiniões reais de compradores.">
    <meta name="twitter:image" content="https://img.comparatop.com.br/assets/og-image.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --c-primary: #1e40af;
            --c-primary-dark: #1e3a8a;
            --c-accent: #f59e0b;
            --c-accent-hover: #d97706;
            --c-bg: #f8fafc;
            --c-surface: #fff;
            --c-text: #1e293b;
            --c-muted: #64748b;
            --c-border: #e2e8f0;
            --c-success: #10b981;
            --c-warning: #ef4444;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, .05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, .07);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, .1);
            --radius: 12px;
            --radius-sm: 8px;
            --sidebar-width: 280px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--c-bg);
            color: var(--c-text);
            line-height: 1.6;
        }

        /* Layout Principal */
        .app-layout {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--c-primary-dark) 0%, #0f172a 100%);
            color: #fff;
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transform: translateX(0);
            /* Default for desktop */
            transition: transform 0.3s ease;
        }

        /* Mobile Overlay */
        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 990;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s 0.3s;
            backdrop-filter: blur(2px);
            cursor: pointer;
        }

        .sidebar-overlay.open {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s ease;
            pointer-events: auto;
        }

        /* Mobile specific styles */
        @media (max-width: 1024px) {
            .sidebar {
                width: 280px;
                transform: translateX(-100%);
                visibility: hidden;
                /* Hide completely when closed */
                transition: transform 0.3s ease, visibility 0s 0.3s;
            }

            .sidebar.open {
                transform: translateX(0);
                visibility: visible;
                /* Show only when open */
                transition: transform 0.3s ease;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
            }

            .main-content {
                margin-left: 0;
            }
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-logo {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sidebar-tagline {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 0.25rem;
        }

        .sidebar-nav {
            padding: 1rem 0;
        }

        .nav-category {
            margin-bottom: 0.5rem;
        }

        .nav-category-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.9);
            width: 100%;
            text-align: left;
        }

        .nav-category-header:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-category-header.active {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
        }

        .nav-category-icon {
            font-size: 1.25rem;
            width: 1.5rem;
            text-align: center;
        }

        .nav-category-arrow {
            margin-left: auto;
            transition: transform 0.2s;
            font-size: 0.75rem;
        }

        .nav-category.open .nav-category-arrow {
            transform: rotate(90deg);
        }

        .nav-subcategories {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: rgba(0, 0, 0, 0.2);
        }

        .nav-category.open .nav-subcategories {
            max-height: 300px;
        }

        .nav-subcategory {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1.5rem 0.6rem 3.5rem;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: all 0.2s;
        }

        .nav-subcategory:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-subcategory.active {
            color: var(--c-accent);
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-subcategory-badge {
            font-size: 0.65rem;
            background: var(--c-accent);
            color: #000;
            padding: 0.1rem 0.4rem;
            border-radius: 10px;
            font-weight: 600;
        }

        /* Product Group Navigation (3rd level) */
        .nav-product-group {
            margin-bottom: 0.25rem;
        }

        .nav-subcategory-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.5rem 0.75rem 0.5rem 1rem;
            color: rgba(255, 255, 255, 0.85);
            font-size: 0.9rem;
            background: transparent;
            border: none;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
        }

        .nav-subcategory-header:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-product-group.open .nav-subcategory-header {
            color: var(--c-accent);
        }

        .nav-product-arrow {
            margin-left: auto;
            font-size: 0.7rem;
            transition: transform 0.2s;
        }

        .nav-product-group.open .nav-product-arrow {
            transform: rotate(0deg);
        }

        .nav-product-group:not(.open) .nav-product-arrow {
            transform: rotate(-90deg);
        }

        .nav-product-list {
            display: none;
            padding-left: 0.5rem;
        }

        .nav-product-group.open .nav-product-list {
            display: block;
        }

        .nav-product-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.75rem 0.4rem 1.5rem;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8rem;
            text-decoration: none;
            transition: all 0.2s;
            border-left: 2px solid transparent;
        }

        .nav-product-item:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
            border-left-color: var(--c-accent);
        }

        .nav-product-item.active {
            color: var(--c-accent);
            background: rgba(255, 255, 255, 0.05);
            border-left-color: var(--c-accent);
        }

        .nav-product-item-img {
            width: 24px;
            height: 24px;
            object-fit: contain;
            border-radius: 4px;
            background: #fff;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: var(--c-surface);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--c-border);
            position: sticky;
            top: 0;
            z-index: 50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--c-primary-dark);
        }

        .header-breadcrumb {
            font-size: 0.85rem;
            color: var(--c-muted);
        }

        .header-breadcrumb a {
            color: var(--c-primary);
            text-decoration: none;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--c-primary);
            margin-right: 0.75rem;
            padding: 0.25rem;
        }

        /* Container */
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Home Cards */
        .home-hero {
            text-align: center;
            padding: 3rem 2rem;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-radius: var(--radius);
            margin-bottom: 2rem;
        }

        .home-hero h1 {
            font-size: 2rem;
            color: var(--c-primary-dark);
            margin-bottom: 0.5rem;
        }

        .home-hero p {
            color: var(--c-muted);
            max-width: 600px;
            margin: 0 auto;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .category-card {
            background: var(--c-surface);
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .category-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--c-primary);
        }

        .category-card-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .category-card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--c-primary-dark);
            margin-bottom: 0.5rem;
        }

        .category-card-desc {
            font-size: 0.9rem;
            color: var(--c-muted);
            margin-bottom: 1rem;
        }

        .category-card-items {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .category-card-tag {
            font-size: 0.75rem;
            background: #f1f5f9;
            color: var(--c-muted);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }

        .category-card-tag.available {
            background: #dcfce7;
            color: #166534;
        }

        /* USP Section */
        .usp-section {
            background: linear-gradient(135deg, #fef3c7 0%, #fcd34d 100%);
            border-radius: var(--radius);
            padding: 2rem;
            margin: 2rem 0;
            border: 2px solid var(--c-accent);
        }

        .usp-title {
            font-size: 1.25rem;
            color: var(--c-primary-dark);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .usp-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .usp-item {
            background: rgba(255, 255, 255, 0.7);
            padding: 1rem;
            border-radius: var(--radius-sm);
        }

        .usp-item-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .usp-item-title {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--c-primary-dark);
        }

        .usp-item-desc {
            font-size: 0.8rem;
            color: var(--c-muted);
        }

        /* Category Page Styles */
        .page-header {
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 1.75rem;
            color: var(--c-primary-dark);
            margin-bottom: 0.5rem;
        }

        .page-desc {
            color: var(--c-muted);
        }

        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 1.5rem;
        }

        .product-card {
            background: var(--c-surface);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .product-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--c-primary-dark);
        }

        .product-brand {
            color: var(--c-muted);
            font-size: 0.9rem;
        }

        .product-score {
            background: var(--c-success);
            color: #fff;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 700;
        }

        /* Specs */
        .specs-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            background: #f8fafc;
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
        }

        .spec-label {
            color: var(--c-muted);
        }

        .spec-value {
            font-weight: 600;
        }

        /* Single Product Page */
        .product-detail {
            max-width: 1000px;
        }

        .product-detail-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
            background: var(--c-surface);
            padding: 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            margin-bottom: 2rem;
        }

        .product-detail-image {
            background: #fff;
            border-radius: var(--radius);
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-detail-image img {
            max-width: 100%;
            max-height: 280px;
            object-fit: contain;
        }

        .product-detail-info {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .product-detail-brand {
            color: var(--c-muted);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .product-detail-model {
            font-size: 2rem;
            color: var(--c-primary-dark);
            margin: 0;
        }

        .product-detail-name {
            color: var(--c-text);
            margin: 0.5rem 0 1rem;
        }

        .product-detail-price {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .product-detail-price .price-label {
            color: var(--c-muted);
            font-size: 0.9rem;
        }

        .product-detail-price .price-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--c-success);
        }

        .product-detail-price .price-store {
            color: var(--c-muted);
            font-size: 0.85rem;
        }

        .btn-buy {
            background: var(--c-success);
            color: #fff;
            margin-bottom: 0.5rem;
        }

        .btn-buy:hover {
            background: #16a34a;
        }

        .btn-compare-large {
            background: var(--c-accent);
            color: #000;
            font-size: 1rem;
            padding: 0.85rem 1.5rem;
        }

        .btn-compare-large:hover {
            background: #fbbf24;
        }

        .btn-compare-large.btn-compare-active {
            background: var(--c-success);
            color: #fff;
        }

        .product-detail-sections {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .product-section {
            background: var(--c-surface);
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
        }

        .product-section h3 {
            color: var(--c-primary-dark);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .scores-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
        }

        .score-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: #f8fafc;
            border-radius: var(--radius-sm);
        }

        .score-icon {
            font-size: 1rem;
        }

        .score-label {
            flex: 1;
            font-size: 0.85rem;
            color: var(--c-text);
        }

        .score-value {
            font-weight: 700;
            font-size: 1rem;
        }

        .voc-summary {
            color: var(--c-text);
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f0f9ff;
            border-radius: var(--radius-sm);
            border-left: 4px solid #0ea5e9;
        }

        .voc-pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .voc-pros,
        .voc-cons {
            padding: 1rem;
            border-radius: var(--radius-sm);
        }

        .voc-pros {
            background: #f0fdf4;
        }

        .voc-cons {
            background: #fef3c7;
        }

        .voc-pros h4,
        .voc-cons h4 {
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
        }

        .voc-pros ul,
        .voc-cons ul {
            margin: 0;
            padding-left: 1.25rem;
        }

        .voc-pros li,
        .voc-cons li {
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .product-detail-grid {
                grid-template-columns: 1fr;
            }

            .voc-pros-cons {
                grid-template-columns: 1fr;
            }
        }

        /* Vertical Offers List */
        .offers-section {
            margin: 1rem 0;
        }

        .offers-list-vertical {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .offer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: #f8fafc;
            border-radius: var(--radius-sm);
            text-decoration: none;
            color: var(--c-text);
            transition: all 0.2s;
        }

        .offer-item:hover {
            background: #f1f5f9;
            transform: translateX(4px);
        }

        .offer-item.offer-best {
            background: #f0fdf4;
        }

        .offer-retailer {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .offer-badge {
            font-size: 0.7rem;
            color: #166534;
            font-weight: 600;
        }

        .offer-store {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .offer-price-action {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .offer-price {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--c-success);
        }

        .offer-btn-small {
            background: var(--c-primary);
            color: #fff;
            padding: 0.4rem 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Quiz Section */
        .quiz-container {
            min-height: 200px;
        }

        .quiz-question {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .quiz-question.active {
            display: block;
        }

        .quiz-progress {
            font-size: 0.8rem;
            color: var(--c-muted);
            margin-bottom: 0.5rem;
        }

        .quiz-q-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--c-primary-dark);
            margin-bottom: 1rem;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .quiz-option {
            padding: 0.75rem 1rem;
            border: 2px solid var(--c-border);
            border-radius: var(--radius-sm);
            background: #fff;
            text-align: left;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quiz-option:hover {
            border-color: var(--c-primary);
            background: #f0f9ff;
        }

        .quiz-option.selected {
            border-color: var(--c-success);
            background: #dcfce7;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(10px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Offers */
        .offers-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .offer-btn {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: var(--radius-sm);
            color: #fff;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s;
        }

        .offer-btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }

        .offer-btn.amazon {
            background: #ff9900;
        }

        .offer-btn.mercado_livre {
            background: #ffe600;
            color: #333;
        }

        .offer-btn.magalu {
            background: #0086ff;
        }

        .offer-btn.shopee {
            background: #ee4d2d;
        }

        .offers-updated {
            font-size: 0.75rem;
            color: var(--c-muted);
            margin-top: 0.5rem;
        }

        /* VoC Section */
        .voc-section {
            background: var(--c-surface);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .voc-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .voc-badge.positive {
            background: #dcfce7;
            color: #166534;
        }

        .voc-badge.mixed {
            background: #fef3c7;
            color: #92400e;
        }

        .voc-badge.negative {
            background: #fee2e2;
            color: #991b1b;
        }

        .voc-oneliner {
            font-size: 1rem;
            font-weight: 500;
            padding: 0.75rem;
            background: #f8fafc;
            border-left: 3px solid var(--c-primary);
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
            margin-bottom: 1rem;
        }

        .voc-summary {
            font-size: 0.9rem;
            color: var(--c-muted);
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: #f0f9ff;
            border-radius: var(--radius-sm);
        }

        .voc-lists {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .voc-list {
            background: #f8fafc;
            border-radius: var(--radius-sm);
            padding: 0.75rem;
        }

        .voc-list-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .voc-list-title.pros {
            color: var(--c-success);
        }

        .voc-list-title.cons {
            color: var(--c-warning);
        }

        .voc-list ul {
            list-style: none;
            font-size: 0.85rem;
        }

        .voc-list li {
            padding: 0.35rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .voc-list li:last-child {
            border-bottom: none;
        }

        .voc-list .topic {
            font-weight: 500;
        }

        .voc-list .freq {
            font-size: 0.75rem;
            color: var(--c-muted);
        }

        .voc-list .detail {
            font-size: 0.8rem;
            color: var(--c-muted);
            display: block;
            margin-top: 0.15rem;
        }

        .voc-sample {
            margin-top: 1rem;
            padding: 0.75rem;
            background: #f1f5f9;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            color: var(--c-muted);
        }

        .voc-sources {
            margin-top: 0.5rem;
        }

        .voc-sources a {
            font-size: 0.75rem;
            color: var(--c-primary);
            margin-right: 0.5rem;
        }

        /* Editorial Scores */
        .editorial-scores {
            margin: 1rem 0;
        }

        .editorial-topic {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--c-border);
            font-size: 0.9rem;
        }

        .editorial-topic:last-child {
            border-bottom: none;
        }

        .editorial-topic-label {
            flex: 1;
        }

        .editorial-topic-score {
            font-weight: 600;
            min-width: 2.5rem;
            text-align: right;
        }

        .editorial-topic-bar {
            width: 80px;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
        }

        .editorial-topic-bar-fill {
            height: 100%;
            border-radius: 3px;
        }

        .editorial-topic-bar-fill.high {
            background: var(--c-success);
        }

        .editorial-topic-bar-fill.medium {
            background: var(--c-accent);
        }

        .editorial-topic-bar-fill.low {
            background: var(--c-warning);
        }

        /* Assistant */
        .assistant-section {
            background: linear-gradient(135deg, #fef3c7, #fef9c3);
            padding: 1.5rem;
            border-radius: var(--radius);
            margin: 2rem 0;
            border: 2px solid var(--c-accent);
        }

        .assistant-section h3 {
            color: var(--c-primary-dark);
            margin-bottom: 1rem;
        }

        .assistant-form {
            display: grid;
            gap: 1rem;
        }

        .form-group {
            background: rgba(255, 255, 255, 0.7);
            padding: 0.75rem;
            border-radius: var(--radius-sm);
        }

        .form-group label {
            display: block;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .form-group input,
        .form-group select {
            padding: 0.5rem;
            border: 1px solid var(--c-border);
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
        }

        .form-row {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .form-row input {
            width: 100px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--c-accent);
            color: #fff;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-sm);
            border: none;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s;
        }

        .btn:hover {
            background: var(--c-accent-hover);
            transform: translateY(-2px);
        }

        /* Results */
        #assistant-results {
            margin-top: 1.5rem;
            display: none;
        }

        #assistant-results.show {
            display: block;
        }

        .result-card {
            background: #fff;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-sm);
        }

        .result-card.winner {
            border: 2px solid var(--c-success);
            position: relative;
        }

        .result-card.winner::before {
            content: "✓ Recomendado";
            position: absolute;
            top: -10px;
            left: 1rem;
            background: var(--c-success);
            color: #fff;
            padding: 0.15rem 0.6rem;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .result-reasons {
            list-style: none;
            margin: 0.75rem 0;
            font-size: 0.9rem;
        }

        .result-reasons li {
            padding: 0.25rem 0;
            padding-left: 1.25rem;
            position: relative;
        }

        .result-reasons li::before {
            content: "→";
            position: absolute;
            left: 0;
            color: var(--c-accent);
        }

        .result-warnings {
            background: #fef3c7;
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            color: #92400e;
            margin: 0.5rem 0;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--c-muted);
        }

        .error {
            background: #fee2e2;
            color: #991b1b;
            padding: 1rem;
            border-radius: var(--radius-sm);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-menu-btn {
                display: block;
            }
        }

        @media (max-width: 768px) {

            .voc-lists,
            .specs-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 1rem;
            }

            .home-hero {
                padding: 2rem 1rem;
            }

            .categories-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Search Bar */
        .search-container {
            position: relative;
            flex: 1;
            max-width: 400px;
            margin: 0 1rem;
        }

        .search-input {
            width: 100%;
            padding: 0.6rem 1rem 0.6rem 2.5rem;
            border: 2px solid var(--c-border);
            border-radius: 25px;
            font-size: 0.9rem;
            transition: all 0.2s;
            background: var(--c-bg);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--c-primary);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 0.85rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--c-muted);
        }

        .search-shortcut {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            background: var(--c-border);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.7rem;
            color: var(--c-muted);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--c-surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            margin-top: 0.5rem;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 200;
        }

        .search-results.show {
            display: block;
        }

        .search-result-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid var(--c-border);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-item:hover {
            background: var(--c-bg);
        }

        .search-result-info {
            flex: 1;
        }

        .search-result-name {
            font-weight: 600;
            color: var(--c-primary-dark);
        }

        .search-result-brand {
            font-size: 0.8rem;
            color: var(--c-muted);
        }

        .search-result-score {
            background: var(--c-success);
            color: #fff;
            padding: 0.15rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .search-no-results {
            padding: 1.5rem;
            text-align: center;
            color: var(--c-muted);
        }

        /* Compare Button on Cards - MORE VISIBLE */
        .compare-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            margin-top: 1rem;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, var(--c-accent) 0%, #fbbf24 100%);
            color: #fff;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }

        .compare-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        }

        .compare-btn.selected {
            background: linear-gradient(135deg, var(--c-primary) 0%, #3b82f6 100%);
            box-shadow: 0 2px 8px rgba(30, 64, 175, 0.3);
        }

        .compare-btn.selected:hover {
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.4);
        }

        /* Floating Compare Counter Badge */
        .compare-counter {
            position: fixed;
            bottom: 100px;
            right: 30px;
            background: var(--c-primary-dark);
            color: #fff;
            padding: 1rem 1.25rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            z-index: 140;
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            animation: bounceIn 0.3s ease;
        }

        .compare-counter.show {
            display: flex;
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .compare-counter-number {
            font-size: 2rem;
            font-weight: 700;
            line-height: 1;
        }

        .compare-counter-text {
            font-size: 0.75rem;
            opacity: 0.9;
        }

        .compare-counter-btn {
            background: var(--c-accent);
            color: #fff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            margin-top: 0.25rem;
        }

        .compare-counter-close {
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: #fff;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 14px;
            line-height: 1;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .compare-counter-close:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        /* Newsletter Section */
        .newsletter-section {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%);
            color: #fff;
            padding: 3rem 2rem;
            border-radius: var(--radius);
            margin: 2rem 0;
            text-align: center;
        }

        .newsletter-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .newsletter-desc {
            opacity: 0.9;
            max-width: 500px;
            margin: 0 auto 1.5rem;
        }

        .newsletter-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 400px;
            margin: 0 auto;
        }

        .newsletter-input {
            padding: 0.85rem 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-sm);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 1rem;
        }

        .newsletter-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .newsletter-input:focus {
            outline: none;
            border-color: var(--c-accent);
            background: rgba(255, 255, 255, 0.15);
        }

        .newsletter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
        }

        .newsletter-option {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .newsletter-option input {
            width: 16px;
            height: 16px;
        }

        .newsletter-btn {
            background: var(--c-accent);
            color: #fff;
            border: none;
            padding: 0.85rem 2rem;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .newsletter-btn:hover {
            background: var(--c-accent-hover);
            transform: translateY(-2px);
        }

        .newsletter-privacy {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.75rem;
        }

        .newsletter-success {
            background: var(--c-success);
            color: #fff;
            padding: 1rem;
            border-radius: var(--radius-sm);
            display: none;
        }

        /* Share Button */
        .share-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: var(--radius-sm);
            color: #fff;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .share-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .share-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--c-success);
            color: #fff;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: transform 0.3s ease, opacity 0.3s ease, visibility 0.3s ease;
            visibility: hidden;
            opacity: 0;
        }

        .share-toast.show {
            transform: translateX(-50%) translateY(0);
            visibility: visible;
            opacity: 1;
        }

        /* Compare Prompt - Small Toast in Bottom Right */
        .compare-prompt {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 280px;
            background: white;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            transform: translateY(150%);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            pointer-events: none;
        }

        .compare-prompt.show {
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
        }

        .compare-prompt h4 {
            margin: 0 0 0.5rem;
            color: #1e40af;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .compare-prompt-products {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            margin-bottom: 0.75rem;
            max-height: 120px;
            overflow-y: auto;
        }

        .compare-prompt-product {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f1f5f9;
            padding: 0.35rem 0.5rem;
            border-radius: 6px;
            font-size: 0.8rem;
        }

        .compare-prompt-hint {
            font-size: 0.75rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .compare-prompt-actions {
            display: flex;
            gap: 0.5rem;
        }

        .compare-prompt-btn {
            flex: 1;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            font-size: 0.8rem;
            transition: transform 0.2s, opacity 0.2s;
        }

        .compare-prompt-btn.primary {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .compare-prompt-btn.secondary {
            background: #e2e8f0;
            color: #475569;
        }

        .compare-prompt-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }


        /* Comparison Floating Bar */
        .compare-bar {
            position: fixed;
            bottom: 0;
            left: var(--sidebar-width);
            right: 0;
            background: var(--c-primary-dark);
            color: #fff;
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 150;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.2);
        }

        .compare-bar.show {
            transform: translateY(0);
        }

        .compare-bar-products {
            display: flex;
            gap: 0.75rem;
            flex: 1;
            overflow-x: auto;
        }

        .compare-bar-product {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.15);
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-sm);
            white-space: nowrap;
        }

        .compare-bar-product-name {
            font-size: 0.85rem;
            font-weight: 500;
        }

        .compare-bar-remove {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 1.1rem;
            padding: 0;
            line-height: 1;
        }

        .compare-bar-remove:hover {
            color: #fff;
        }

        .compare-bar-actions {
            display: flex;
            gap: 0.75rem;
        }

        .compare-bar-btn {
            padding: 0.6rem 1.25rem;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .compare-bar-btn.primary {
            background: var(--c-accent);
            color: #fff;
        }

        .compare-bar-btn.primary:hover {
            background: var(--c-accent-hover);
        }

        .compare-bar-btn.secondary {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }

        .compare-bar-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Comparison Modal */
        .compare-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 500;
            display: none;
            align-items: flex-start;
            justify-content: center;
            padding: 2rem;
            overflow-y: auto;
        }

        .compare-modal.show {
            display: flex;
        }

        .compare-modal-content {
            background: var(--c-surface);
            border-radius: var(--radius);
            width: 100%;
            max-width: 1200px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .compare-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--c-border);
        }

        .compare-modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--c-primary-dark);
        }

        .compare-modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--c-muted);
            padding: 0.25rem;
        }

        .compare-modal-close:hover {
            color: var(--c-text);
        }

        .compare-modal-body {
            padding: 1.5rem;
            overflow-x: auto;
            overflow-y: auto;
            flex: 1;
        }

        /* Social Share Buttons */
        .share-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .share-social-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s;
        }

        .share-social-btn:hover {
            transform: scale(1.1);
        }

        .share-social-btn.whatsapp {
            background: #25D366;
            color: #fff;
        }

        .share-social-btn.telegram {
            background: #0088cc;
            color: #fff;
        }

        .share-social-btn.facebook {
            background: #1877F2;
            color: #fff;
        }

        .share-social-btn.twitter {
            background: #000;
            color: #fff;
        }

        .share-social-btn.email {
            background: #EA4335;
            color: #fff;
        }

        .share-social-btn.copy {
            background: #6b7280;
            color: #fff;
        }

        /* Sidebar Channels */
        .sidebar-channels {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--c-border);
        }

        .sidebar-channels-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--c-muted);
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar-channels-btns {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .sidebar-channel-btn {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            padding: 0.6rem 0.85rem;
            border-radius: var(--radius-sm);
            text-decoration: none;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .sidebar-channel-btn:hover {
            transform: translateX(4px);
        }

        .sidebar-channel-btn.telegram {
            background: #0088cc;
            color: #fff;
        }

        .sidebar-channel-btn.whatsapp {
            background: #25D366;
            color: #fff;
        }

        /* Header Social Icons */
        .header-social-icons {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .header-social-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            text-decoration: none;
            transition: all 0.2s;
            opacity: 0.7;
        }

        .header-social-btn:hover {
            opacity: 1;
            transform: scale(1.15);
        }

        .header-social-btn.whatsapp {
            background: #25D366;
            color: #fff;
        }

        .header-social-btn.telegram {
            background: #0088cc;
            color: #fff;
        }

        .header-social-btn.facebook {
            background: #1877F2;
            color: #fff;
        }

        .header-social-btn.instagram {
            background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
            color: #fff;
        }

        .header-social-btn.email {
            background: #EA4335;
            color: #fff;
        }

        .header-social-btn.x {
            background: #000;
            color: #fff;
        }

        .compare-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        .compare-table th,
        .compare-table td {
            padding: 0.75rem 1rem;
            text-align: center;
            border-bottom: 1px solid var(--c-border);
        }

        .compare-table th {
            background: var(--c-bg);
            font-weight: 600;
            color: var(--c-primary-dark);
        }

        .compare-table th:first-child,
        .compare-table td:first-child {
            text-align: left;
            font-weight: 500;
            background: #f8fafc;
            position: sticky;
            left: 0;
            z-index: 5;
            box-shadow: 2px 0 4px rgba(0, 0, 0, 0.1);
        }

        .compare-table td.winner {
            background: #dcfce7;
            font-weight: 600;
        }

        .compare-table .product-cell {
            min-width: 180px;
        }

        .compare-table .product-name {
            font-weight: 700;
            font-size: 1rem;
        }

        .compare-table .product-brand {
            font-size: 0.8rem;
            color: var(--c-muted);
        }

        .compare-table .score-badge {
            display: inline-block;
            background: var(--c-success);
            color: #fff;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 0.25rem;
        }

        .compare-section-header {
            background: var(--c-primary) !important;
            color: #fff !important;
        }

        .compare-section-header td {
            background: var(--c-primary) !important;
            color: #fff !important;
            font-weight: 600;
        }

        /* Title row with zoom controls */
        .compare-modal-title-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            width: 100%;
        }

        .font-zoom-controls {
            display: flex;
            gap: 0.25rem;
        }

        .font-zoom-btn {
            background: var(--c-primary-light);
            color: var(--c-primary-dark);
            border: 1px solid var(--c-border);
            border-radius: var(--radius-sm);
            padding: 0.3rem 0.6rem;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .font-zoom-btn:hover {
            background: var(--c-primary);
            color: #fff;
        }

        /* Floating Compare Bar */
        .compare-bar {
            position: fixed;
            bottom: 0;
            left: 240px;
            right: 0;
            background: white;
            border-top: 1px solid var(--c-border);
            padding: 1rem 1.5rem;
            display: none;
            align-items: center;
            justify-content: space-between;
            z-index: 100;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        }

        .compare-bar.show {
            display: flex;
        }

        .compare-bar-products {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .compare-bar-product {
            background: var(--c-primary-light);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .compare-bar-product-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .compare-bar-remove {
            background: none;
            border: none;
            color: var(--c-muted);
            cursor: pointer;
            font-size: 0.8rem;
        }

        .compare-bar-remove:hover {
            color: var(--c-danger);
        }

        .compare-bar-actions {
            display: flex;
            gap: 0.75rem;
        }

        .compare-bar-btn {
            padding: 0.6rem 1.25rem;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            border: none;
        }

        .compare-bar-btn.primary {
            background: var(--c-primary);
            color: white;
        }

        .compare-bar-btn.secondary {
            background: #e2e8f0;
            color: #475569;
        }

        /* Floating Counter */
        .compare-counter {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 1rem;
            border-radius: var(--radius);
            display: none;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
            z-index: 99;
        }

        .compare-counter.show {
            display: flex;
        }

        .compare-counter-number {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .compare-counter-text {
            font-size: 0.75rem;
            opacity: 0.9;
        }

        .compare-counter-btn {
            margin-top: 0.75rem;
            background: white;
            color: var(--c-primary);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            font-size: 0.85rem;
        }

        /* Compare Modal */
        .compare-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .compare-modal.show {
            display: flex;
        }

        .compare-modal-content {
            background: white;
            border-radius: var(--radius);
            max-width: 95vw;
            max-height: 90vh;
            overflow: auto;
            width: 100%;
        }

        .compare-modal-header {
            position: sticky;
            top: 0;
            background: white;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--c-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .compare-modal-title {
            margin: 0;
            font-size: 1.25rem;
        }

        .compare-modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--c-muted);
        }

        .compare-modal-body {
            padding: 1.5rem;
        }

        @media (max-width: 1024px) {
            .compare-bar {
                left: 0;
            }

            .search-container {
                display: none;
            }
        }

        /* Tablet breakpoint */
        @media (max-width: 768px) {
            .sidebar {
                width: 85%;
                max-width: 280px;
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .products-grid {
                grid-template-columns: 1fr;
            }

            .compare-modal-content {
                width: 95%;
                max-height: 90vh;
            }

            /* Reorganize modal header for mobile - social buttons + X on top, title below */
            .compare-modal-header {
                flex-direction: column-reverse;
                align-items: stretch;
                gap: 0.5rem;
                padding: 0.75rem 1rem;
            }

            .compare-modal-header>div {
                display: flex;
                justify-content: space-between;
                align-items: center;
                width: 100%;
            }

            .compare-modal-header .share-buttons {
                flex-wrap: nowrap;
                gap: 0.35rem;
            }

            .compare-modal-header .share-social-btn {
                width: 32px;
                height: 32px;
                font-size: 0.9rem;
            }

            .compare-modal-title {
                font-size: 1rem;
                text-align: center;
            }

            .compare-modal-body {
                padding: 1rem;
            }

            /* Tables with horizontal scroll */
            .comparison-table-wrapper,
            .specs-table-wrapper,
            table {
                display: block;
                width: 100%;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .comparison-table {
                min-width: 600px;
            }

            /* Smaller fonts for compare table on mobile */
            .compare-table {
                min-width: 400px;
                font-size: 0.75rem;
            }

            .compare-table th,
            .compare-table td {
                padding: 0.4rem 0.5rem;
            }

            .compare-table .product-cell {
                min-width: 100px;
            }

            .compare-table .product-name {
                font-size: 0.8rem;
            }

            .compare-table .product-brand {
                font-size: 0.65rem;
            }

            .compare-table .score-badge {
                font-size: 0.7rem;
                padding: 0.15rem 0.4rem;
            }

            .header-title {
                font-size: 1rem;
            }

            .header-social-icons {
                display: flex;
                gap: 0.35rem;
            }

            .header-social-btn {
                width: 28px;
                height: 28px;
            }

            .header-social-btn svg {
                width: 14px;
                height: 14px;
            }
        }

        /* Phone breakpoint */
        @media (max-width: 480px) {
            .product-card {
                padding: 1rem;
            }

            .product-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .product-score {
                align-self: flex-end;
            }

            .specs-grid {
                grid-template-columns: 1fr 1fr;
                gap: 0.5rem;
            }

            .offers-grid {
                grid-template-columns: 1fr;
            }

            .offer-btn {
                padding: 0.75rem;
                font-size: 0.9rem;
            }

            .compare-bar {
                flex-direction: column;
                padding: 0.75rem;
                gap: 0.5rem;
            }

            .compare-bar-products {
                flex-wrap: wrap;
                justify-content: center;
            }

            .page-title {
                font-size: 1.25rem;
            }

            .editorial-topic {
                flex-direction: column;
                text-align: center;
                gap: 0.25rem;
            }

            /* Table scroll indicator */
            .comparison-table-wrapper::after {
                content: '← Arraste para ver mais →';
                display: block;
                text-align: center;
                font-size: 0.75rem;
                color: var(--c-muted);
                padding: 0.5rem;
            }
        }

        /* Accessibility improvements */
        .skip-to-content {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--c-primary);
            color: white;
            padding: 0.5rem 1rem;
            z-index: 10000;
            transition: top 0.3s;
        }

        .skip-to-content:focus {
            top: 0;
        }

        /* Focus visible for keyboard navigation */
        *:focus-visible {
            outline: 3px solid var(--c-primary);
            outline-offset: 2px;
        }

        button:focus-visible,
        a:focus-visible {
            outline: 3px solid var(--c-primary);
            outline-offset: 2px;
        }
    </style>
    <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "ComparaTop",
  "url": "https://comparatop.com.br",
  "description": "Compare eletrodomésticos antes de comprar",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://comparatop.com.br/busca?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}</script>
<script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "Geladeira Samsung Evolution RT46 com POWERvolt Inverter Duplex 460L",
  "brand": {
    "@type": "Brand",
    "name": "Samsung"
  },
  "model": "RT46",
  "sku": "samsung-rt46",
  "description": "Samsung RT46 - Geladeiras 460L",
  "offers": {
    "@type": "AggregateOffer",
    "lowPrice": 3899,
    "highPrice": 3899,
    "priceCurrency": "BRL",
    "offerCount": 1,
    "availability": "https://schema.org/InStock"
  },
  "dateModified": "2025-12-26T12:39:59.135Z"
}</script>
<script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Início",
      "item": "https://comparatop.com.br/"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Geladeiras",
      "item": "https://comparatop.com.br/geladeiras/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Geladeira Samsung Evolution RT46 com POWERvolt Inverter Duplex 460L"
    }
  ]
}</script>
</head>

<body>

    <!-- Pre-rendered content for SEO (bots will see this) -->
    <div id="prerendered-content" class="prerendered-seo-content">
        <nav aria-label="Breadcrumb" class="breadcrumb-nav">
            <a href="/">Início</a> › 
            <a href="/categoria/geladeira">Geladeiras</a> › 
            <span>Geladeira Samsung Evolution RT46 com POWERvolt Inverter Duplex 460L</span>
        </nav>
        
        <article itemscope itemtype="https://schema.org/Product">
            <h1 itemprop="name">Geladeira Samsung Evolution RT46 com POWERvolt Inverter Duplex 460L</h1>
            
            <div class="product-summary">
                <p itemprop="description">
                    Geladeira Samsung RT46 com 460L de capacidade, , Selo Procel A.
                </p>
                
                <div class="product-rating">
                    <strong>Nota Editorial:</strong> 
                    <span itemprop="aggregateRating" itemscope itemtype="https://schema.org/AggregateRating">
                        <span itemprop="ratingValue">0</span>/10
                    </span>
                </div>
            </div>
            
            <section class="specs-section">
                <h2>Especificações Técnicas</h2>
                <table class="specs-table">
                    <tr><th>Capacidade Total</th><td>460L</td></tr>
                    <tr><th>Capacidade Freezer</th><td>112L</td></tr>
                    <tr><th>Consumo</th><td>- kWh/mês</td></tr>
                    <tr><th>Dimensões (L×A×P)</th><td>- × - × - cm</td></tr>
                    <tr><th>Peso</th><td>- kg</td></tr>
                    <tr><th>Selo Procel</th><td>-</td></tr>
                    <tr><th>Frost Free</th><td>Não</td></tr>
                </table>
            </section>
            
            
            <section class="offers-section" itemprop="offers" itemscope itemtype="https://schema.org/AggregateOffer">
                <h2>Onde Comprar</h2>
                <meta itemprop="priceCurrency" content="BRL">
                <meta itemprop="lowPrice" content="3899">
                <ul class="offers-list">
                    
                        <li>
                            <strong>Amazon</strong>: 
                            R$ 3.899,00
                            
                        </li>
                    
                </ul>
            </section>
            
            
            
        </article>
    </div>
    
    <style>
        .prerendered-seo-content { display: none; }
        /* Note: This content is hidden visually but readable by bots */
        /* JavaScript will render the interactive version */
    </style>
    

    <div id="prerendered-content" class="prerendered-seo-content">
        <h1>ComparaTop - Compare Eletrodomésticos</h1>
        <p>Encontre o produto ideal comparando especificações, preços e avaliações reais de milhares de compradores.</p>
        <nav>
            <h2>Categorias</h2>
            <ul>

                <li><a href="/categoria/geladeira">Geladeiras</a></li>

            </ul>
        </nav>
    </div>
    <style>
        .prerendered-seo-content {
            display: none;
        }
    </style>

    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-to-content">Pular para o conteúdo principal</a>

    <div class="app-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">⚡ ComparaTop</div>
                <div class="sidebar-tagline">Compare antes de comprar</div>
            </div>
            <nav class="sidebar-nav">
                <!-- Home -->
                <a href="/" class="nav-category-header active" onclick="Router.navigate('/'); return false;">
                    <span class="nav-category-icon">🏠</span>
                    <span>Início</span>
                </a>

                <!-- Climatização -->
                <div class="nav-category">
                    <button class="nav-category-header" onclick="toggleCategory(this.parentElement)">
                        <span class="nav-category-icon">🌬️</span>
                        <span>Climatização</span>
                        <span class="nav-category-arrow">▸</span>
                    </button>
                    <div class="nav-subcategories">
                        <a href="#" class="nav-subcategory">Aquecedores</a>
                        <a href="#" class="nav-subcategory">Ar-condicionado</a>
                        <a href="#" class="nav-subcategory">Ventiladores</a>
                    </div>
                </div>

                <!-- Cocção -->
                <div class="nav-category">
                    <button class="nav-category-header" onclick="toggleCategory(this.parentElement)">
                        <span class="nav-category-icon">🔥</span>
                        <span>Cocção</span>
                        <span class="nav-category-arrow">▸</span>
                    </button>
                    <div class="nav-subcategories">
                        <a href="#" class="nav-subcategory">Coifas e Depuradores</a>
                        <a href="#" class="nav-subcategory">Cooktops</a>
                        <a href="#" class="nav-subcategory">Fogões</a>
                        <a href="#" class="nav-subcategory">Fornos</a>
                        <a href="#" class="nav-subcategory">Micro-ondas</a>
                    </div>
                </div>

                <!-- Lavanderia -->
                <div class="nav-category">
                    <button class="nav-category-header" onclick="toggleCategory(this.parentElement)">
                        <span class="nav-category-icon">🧺</span>
                        <span>Lavanderia</span>
                        <span class="nav-category-arrow">▸</span>
                    </button>
                    <div class="nav-subcategories">
                        <a href="#" class="nav-subcategory">Lava e Seca</a>
                        <a href="#" class="nav-subcategory">Lava-louças</a>
                        <a href="#" class="nav-subcategory">Lavadoras de Roupa</a>
                        <a href="#" class="nav-subcategory">Secadoras</a>
                    </div>
                </div>

                <!-- Refrigeração -->
                <div class="nav-category">
                    <button class="nav-category-header" onclick="toggleCategory(this.parentElement)">
                        <span class="nav-category-icon">❄️</span>
                        <span>Refrigeração</span>
                        <span class="nav-category-arrow">▸</span>
                    </button>
                    <div class="nav-subcategories">
                        <a href="/categoria/freezer" class="nav-subcategory"
                            onclick="Router.navigate('/categoria/freezer'); return false;">
                            Freezers
                            <span class="nav-subcategory-badge" style="background:#64748b;">Em breve</span>
                        </a>
                        <a href="/categoria/frigobar" class="nav-subcategory"
                            onclick="Router.navigate('/categoria/frigobar'); return false;">
                            Frigobares
                            <span class="nav-subcategory-badge" style="background:#64748b;">Em breve</span>
                        </a>
                        <!-- Geladeiras with Product Models -->
                        <div class="nav-product-group" id="nav-geladeiras">
                            <button class="nav-subcategory-header" onclick="toggleProductGroup(this.parentElement)">
                                Geladeiras
                                <span class="nav-subcategory-badge">2</span>
                                <span class="nav-product-arrow">▾</span>
                            </button>
                            <div class="nav-product-list" id="nav-geladeiras-products">
                                <a href="/produto/geladeira/brm44hb" class="nav-subcategory" onclick="Router.navigate('/produto/geladeira/brm44hb'); closeSidebar(); return false;">Brastemp BRM44HB 375L</a>
                                <a href="/produto/geladeira/tf55" class="nav-subcategory" onclick="Router.navigate('/produto/geladeira/tf55'); closeSidebar(); return false;">Electrolux TF55 431L</a>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="header">
                <button class="mobile-menu-btn" type="button" style="display:block;">☰</button>
                <div>
                    <div class="header-breadcrumb" id="breadcrumb">
                        <a href="/">Início</a>
                    </div>
                    <div style="display:flex;align-items:center;gap:0.75rem;">
                        <div class="header-title" id="header-title">Bem-vindo ao ComparaTop</div>
                        <div class="header-social-icons">
                            <a href="#" class="header-social-btn whatsapp" onclick="trackChannel('whatsapp')"
                                title="WhatsApp">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                                    <path
                                        d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
                                </svg>
                            </a>
                            <a href="#" class="header-social-btn telegram" onclick="trackChannel('telegram')"
                                title="Telegram">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                                    <path
                                        d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z" />
                                </svg>
                            </a>
                            <a href="#" class="header-social-btn facebook" onclick="trackChannel('facebook')"
                                title="Facebook">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                                    <path
                                        d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
                                </svg>
                            </a>
                            <a href="#" class="header-social-btn instagram" onclick="trackChannel('instagram')"
                                title="Instagram">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                                    <path
                                        d="M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z" />
                                </svg>
                            </a>
                            <a href="#" class="header-social-btn x" onclick="trackChannel('x')" title="X (Twitter)">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                                    <path
                                        d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
                                </svg>
                            </a>
                            <a href="#" class="header-social-btn email" onclick="trackChannel('email')" title="Email">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                                    <path
                                        d="M1.5 8.67v8.58a3 3 0 003 3h15a3 3 0 003-3V8.67l-8.928 5.493a3 3 0 01-3.144 0L1.5 8.67z" />
                                    <path
                                        d="M22.5 6.908V6.75a3 3 0 00-3-3h-15a3 3 0 00-3 3v.158l9.714 5.978a1.5 1.5 0 001.572 0L22.5 6.908z" />
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Search Bar -->
                <div class="search-container">
                    <span class="search-icon">🔍</span>
                    <input type="text" class="search-input" id="search-input" placeholder="Buscar produtos..."
                        autocomplete="off">
                    <span class="search-shortcut">Ctrl+K</span>
                    <div class="search-results" id="search-results"></div>
                </div>
            </header>

            <div class="container">
                <!-- Home Page -->
                <div class="container">
                    <!-- Mobile Overlay Element -->
                    <div id="sidebar-overlay" class="sidebar-overlay" onclick="handleOverlayClick()"></div>

                    <!-- Compare Toast (Small notification) -->
                    <div id="compare-prompt" class="compare-prompt">
                        <h4>⚖️ Comparar?</h4>
                        <div id="compare-prompt-products" class="compare-prompt-products"></div>
                        <p class="compare-prompt-hint" id="compare-prompt-hint"></p>
                        <div class="compare-prompt-actions">
                            <button class="compare-prompt-btn primary" id="compare-prompt-btn-compare"
                                onclick="startComparisonFromPrompt()">Comparar</button>
                            <button class="compare-prompt-btn secondary" onclick="hideCompareToast()">✕</button>
                        </div>
                    </div>

                    <!-- Home Page -->
                    <div id="page-home">
                        <section class="home-hero">
                            <h1>🏆 Compare antes de comprar</h1>
                            <p>Análise <strong>transparente</strong> de eletrodomésticos com síntese de milhares de
                                avaliações reais de compradores</p>
                        </section>

                        <section class="usp-section">
                            <h3 class="usp-title">💡 Por que somos diferentes?</h3>
                            <div class="usp-grid">
                                <div class="usp-item">
                                    <div class="usp-item-icon">🗣️</div>
                                    <div class="usp-item-title">Voz do Cliente Real</div>
                                    <div class="usp-item-desc">Síntese de milhares de reviews: Amazon, Mercado Livre,
                                        Magazine Luiza, Shopee, YouTube e Reclame Aqui</div>
                                </div>
                                <div class="usp-item">
                                    <div class="usp-item-icon">📊</div>
                                    <div class="usp-item-title">Notas Editoriais</div>
                                    <div class="usp-item-desc">Até 10 critérios avaliados por categoria: durabilidade,
                                        custo-benefício, qualidade e mais</div>
                                </div>
                                <div class="usp-item">
                                    <div class="usp-item-icon">🎯</div>
                                    <div class="usp-item-title">Assistente Inteligente</div>
                                    <div class="usp-item-desc">Responda perguntas simples e descubra o produto ideal
                                        para
                                        você</div>
                                </div>
                                <div class="usp-item">
                                    <div class="usp-item-icon">🔗</div>
                                    <div class="usp-item-title">Fontes Transparentes</div>
                                    <div class="usp-item-desc">Citamos todas as fontes para você verificar</div>
                                </div>
                            </div>
                        </section>

                        <!-- Global Product Recommender -->
                        <section class="recommender-section"
                            style="background:linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);border-radius:var(--radius);padding:2rem;margin:2rem 0;color:white;">
                            <h2 style="margin:0 0 0.5rem;font-size:1.5rem;">🎯 Encontre o Produto Ideal</h2>
                            <p style="margin:0 0 1.5rem;opacity:0.9;">Selecione a categoria e responda perguntas rápidas
                                para descobrir qual produto combina melhor com você!</p>

                            <!-- Category Selector -->
                            <div id="quiz-category-selector" style="margin-bottom:1.5rem;">
                                <label style="display:block;margin-bottom:0.5rem;font-weight:600;">Qual categoria você
                                    procura?</label>
                                <select id="quiz-category-select"
                                    style="width:100%;max-width:300px;padding:0.75rem;border-radius:var(--radius-sm);border:none;font-size:1rem;color:#1e293b;">
                                    <option value="">Selecione uma categoria...</option>
                                    <option value="geladeira">❄️ Geladeiras</option>
                                    <option value="fogao" disabled>🔥 Fogões (em breve)</option>
                                    <option value="lavadora" disabled>🧺 Lavadoras (em breve)</option>
                                    <option value="ar-condicionado" disabled>🌬️ Ar-condicionado (em breve)</option>
                                </select>
                            </div>

                            <div id="global-quiz-container">
                                <div id="global-quiz-questions"></div>
                                <div id="global-quiz-result" style="display:none;"></div>
                            </div>

                            <button class="btn" id="start-global-quiz-btn" onclick="startGlobalQuiz()"
                                style="background:white;color:#1d4ed8;font-weight:600;padding:0.75rem 2rem;border:none;border-radius:var(--radius);cursor:pointer;font-size:1rem;display:none;">
                                ✨ Iniciar Assistente
                            </button>
                        </section>

                        <h2 style="color:var(--c-primary-dark);margin:2rem 0 1rem;">📦 Explore por Categoria</h2>
                        <div class="categories-grid">
                            <!-- Climatização -->
                            <div class="category-card">
                                <div class="category-card-icon">🌬️</div>
                                <div class="category-card-title">Climatização</div>
                                <div class="category-card-desc">Ar-condicionado, ventiladores e aquecedores para seu
                                    conforto</div>
                                <div class="category-card-items">
                                    <span class="category-card-tag">Aquecedores</span>
                                    <span class="category-card-tag">Ar-condicionado</span>
                                    <span class="category-card-tag">Ventiladores</span>
                                </div>
                            </div>
                            <!-- Cocção -->
                            <div class="category-card">
                                <div class="category-card-icon">🔥</div>
                                <div class="category-card-title">Cocção</div>
                                <div class="category-card-desc">Fogões, cooktops, fornos e micro-ondas para preparar
                                    suas
                                    refeições</div>
                                <div class="category-card-items">
                                    <span class="category-card-tag">Coifas e Depuradores</span>
                                    <span class="category-card-tag">Cooktops</span>
                                    <span class="category-card-tag">Fogões</span>
                                    <span class="category-card-tag">Fornos</span>
                                    <span class="category-card-tag">Micro-ondas</span>
                                </div>
                            </div>
                            <!-- Lavanderia -->
                            <div class="category-card">
                                <div class="category-card-icon">🧺</div>
                                <div class="category-card-title">Lavanderia e Limpeza</div>
                                <div class="category-card-desc">Lavadoras, secadoras e lava-louças para facilitar sua
                                    rotina
                                </div>
                                <div class="category-card-items">
                                    <span class="category-card-tag">Lava e Seca</span>
                                    <span class="category-card-tag">Lava-louças</span>
                                    <span class="category-card-tag">Lavadoras</span>
                                    <span class="category-card-tag">Secadoras</span>
                                </div>
                            </div>
                            <!-- Refrigeração -->
                            <div class="category-card" onclick="showCategory('geladeira')">
                                <div class="category-card-icon">❄️</div>
                                <div class="category-card-title">Refrigeração e Conservação</div>
                                <div class="category-card-desc">Geladeiras, freezers e frigobares para manter seus
                                    alimentos
                                    frescos</div>
                                <div class="category-card-items">
                                    <span class="category-card-tag">Freezers</span>
                                    <span class="category-card-tag">Frigobares</span>
                                    <span class="category-card-tag available">Geladeiras (2)</span>
                                </div>
                            </div>
                        </div>

                        <!-- Produtos Populares Section (SEO) -->
                        <section class="popular-products-section"
                            style="margin: 2rem 0; padding: 2rem; background: var(--c-surface); border-radius: var(--radius); box-shadow: var(--shadow-sm);">
                            <h2 style="color: var(--c-primary-dark); margin-bottom: 1rem; font-size: 1.5rem;">📦
                                Produtos
                                Populares</h2>
                            <p style="color: var(--c-muted); margin-bottom: 1.5rem;">Confira os produtos mais buscados
                                pelos
                                nossos usuários:</p>

                            <div
                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
                                <a href="/produto/geladeira/brm44hb/"
                                    style="display: block; padding: 1.5rem; background: #f8fafc; border-radius: var(--radius-sm); text-decoration: none; color: var(--c-text); transition: all 0.2s; border: 2px solid transparent;">
                                    <div style="font-weight: 700; color: var(--c-primary-dark);">❄️ Brastemp BRM44HB
                                        375L
                                    </div>
                                    <div style="font-size: 0.9rem; color: var(--c-muted); margin-top: 0.5rem;">Geladeira
                                        Frost Free com compartimento Extra Frio</div>
                                    <div
                                        style="font-size: 0.85rem; color: var(--c-success); margin-top: 0.5rem; font-weight: 600;">
                                        A partir de R$ 3.149,90 →</div>
                                </a>
                                <a href="/produto/geladeira/tf55/"
                                    style="display: block; padding: 1.5rem; background: #f8fafc; border-radius: var(--radius-sm); text-decoration: none; color: var(--c-text); transition: all 0.2s; border: 2px solid transparent;">
                                    <div style="font-weight: 700; color: var(--c-primary-dark);">❄️ Electrolux TF55 431L
                                    </div>
                                    <div style="font-size: 0.9rem; color: var(--c-muted); margin-top: 0.5rem;">Geladeira
                                        Frost Free com Blue Touch e prateleiras flexíveis</div>
                                    <div
                                        style="font-size: 0.85rem; color: var(--c-success); margin-top: 0.5rem; font-weight: 600;">
                                        A partir de R$ 3.399,90 →</div>
                                </a>
                            </div>

                            <h3 style="color: var(--c-primary-dark); margin: 2rem 0 1rem; font-size: 1.25rem;">⚖️
                                Comparações em Destaque</h3>
                            <div>
                                <a href="/comparar/brm44hb-vs-tf55/"
                                    style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 1rem 1.5rem; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border-radius: var(--radius-sm); text-decoration: none; font-weight: 600; transition: all 0.2s;">
                                    ⚖️ Brastemp BRM44HB vs Electrolux TF55 — Qual escolher?
                                </a>
                            </div>
                        </section>

                        <!-- Newsletter Section -->
                        <section class="newsletter-section">
                            <h3 class="newsletter-title">📬 Fique por dentro das melhores ofertas</h3>
                            <p class="newsletter-desc">Receba alertas de preço, novos comparativos e promoções
                                exclusivas
                                pelos seus canais preferidos.</p>

                            <div id="newsletter-form-container">
                                <div class="newsletter-form">
                                    <input type="email" class="newsletter-input" id="newsletter-email"
                                        placeholder="Seu melhor email">

                                    <div class="newsletter-options">
                                        <label class="newsletter-option">
                                            <input type="checkbox" id="nl-price" checked> 🔔 Alertas de preço
                                        </label>
                                        <label class="newsletter-option">
                                            <input type="checkbox" id="nl-new" checked> 📊 Novos comparativos
                                        </label>
                                        <label class="newsletter-option">
                                            <input type="checkbox" id="nl-promo"> 💰 Promoções semanais
                                        </label>
                                    </div>

                                    <button class="newsletter-btn" onclick="subscribeNewsletter()">✓ Cadastrar
                                        Email</button>

                                    <!-- Broadcast Channels -->
                                    <div
                                        style="margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid rgba(255,255,255,0.2);">
                                        <p style="font-size:0.9rem;margin-bottom:0.75rem;">📢 Ou siga nossos canais:</p>
                                        <div style="display:flex;gap:0.75rem;flex-wrap:wrap;justify-content:center;">
                                            <a href="#" target="_blank" onclick="trackChannel('telegram')"
                                                style="display:flex;align-items:center;gap:0.5rem;background:#0088cc;color:#fff;padding:0.6rem 1rem;border-radius:var(--radius-sm);text-decoration:none;font-weight:600;font-size:0.9rem;">
                                                <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                                                    <path
                                                        d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z" />
                                                </svg>
                                                Telegram
                                            </a>
                                            <a href="#" target="_blank" onclick="trackChannel('whatsapp')"
                                                style="display:flex;align-items:center;gap:0.5rem;background:#25D366;color:#fff;padding:0.6rem 1rem;border-radius:var(--radius-sm);text-decoration:none;font-weight:600;font-size:0.9rem;">
                                                <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                                                    <path
                                                        d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
                                                </svg>
                                                WhatsApp
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                <p class="newsletter-privacy">🔒 Seus dados estão seguros. Não fazemos spam e você pode
                                    cancelar a qualquer momento.</p>
                            </div>

                            <div class="newsletter-success" id="newsletter-success">
                                ✓ Cadastro realizado com sucesso! Você receberá nossas atualizações em breve.
                            </div>
                        </section>
                    </div>

                    <!-- Category Page (dynamic) -->
                    <div id="page-category" style="display:none;">
                        <div class="page-header">
                            <h1 class="page-title" id="category-title">Geladeiras</h1>
                            <p class="page-desc" id="category-desc">Compare modelos com base em análises reais de
                                compradores</p>
                        </div>

                        <div id="loading" class="loading" style="display:none;">⏳ Carregando catálogo...</div>
                        <div id="error" class="error" style="display:none;"></div>

                        <!-- Products Grid Section - FIRST -->
                        <section style="margin-bottom:2rem;">
                            <h2 style="color:var(--c-primary-dark);margin-bottom:1rem;">📦 Modelos Disponíveis</h2>
                            <p style="color:var(--c-muted);font-size:0.9rem;margin-bottom:1.5rem;">Clique em um modelo
                                para ver a ficha técnica completa, ou marque para comparar.</p>
                            <div id="products-grid" class="products-grid"></div>
                        </section>

                        <!-- Assistant Section -->
                        <section class="assistant-section">
                            <h3>🎯 Qual geladeira é ideal para você?</h3>
                            <p style="margin-bottom:1rem;color:var(--c-muted);font-size:0.9rem;">Responda as perguntas e
                                veja
                                recomendações personalizadas baseadas em <strong>análise agregada</strong> de milhares
                                de
                                avaliações.</p>

                            <div class="assistant-form">
                                <div class="form-group">
                                    <label>📐 Largura do seu nicho (cm):</label>
                                    <input type="number" id="q-niche" placeholder="Ex: 66" min="50" max="150">
                                    <small style="color:var(--c-muted);font-size:0.8rem;margin-left:0.5rem;">Deixe em
                                        branco
                                        se não
                                        souber</small>
                                </div>

                                <div class="form-group">
                                    <label>💰 Faixa de orçamento (R$):</label>
                                    <div class="form-row">
                                        <span>De</span>
                                        <input type="number" id="q-budget-min" placeholder="2000" min="1000">
                                        <span>até</span>
                                        <input type="number" id="q-budget-max" placeholder="4000" min="1000">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>❄️ Uso do freezer:</label>
                                    <select id="q-freezer">
                                        <option value="pouco">Pouco (congelo raramente)</option>
                                        <option value="medio" selected>Médio (uso normal)</option>
                                        <option value="muito">Muito (congelo bastante)</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label>🎯 Sua prioridade principal:</label>
                                    <select id="q-priority">
                                        <option value="espaco">Caber no espaço disponível</option>
                                        <option value="freezer">Freezer grande</option>
                                        <option value="consumo" selected>Menor consumo de energia</option>
                                        <option value="funcoes">Funções e painel digital</option>
                                        <option value="custo">Menor preço</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label>🔇 Sensibilidade a ruído:</label>
                                    <select id="q-noise">
                                        <option value="sim">Sim, muito sensível</option>
                                        <option value="nao" selected>Não me incomoda</option>
                                    </select>
                                </div>

                                <button class="btn" onclick="runAssistant()">Ver Recomendações</button>
                            </div>

                            <div id="assistant-results"></div>
                            <!-- Calculators Section -->
                            <section style="margin-top:2rem;">
                                <h2 style="color:var(--c-primary-dark);margin-bottom:1rem;">🧮 Calculadoras</h2>
                                <div
                                    style="display:grid;grid-template-columns:repeat(auto-fit, minmax(320px, 1fr));gap:1.5rem;">

                                    <!-- Energy Consumption Calculator -->
                                    <div
                                        style="background:var(--c-surface);border-radius:var(--radius);padding:1.5rem;box-shadow:var(--shadow-sm);">
                                        <h3 style="color:var(--c-primary-dark);font-size:1.1rem;margin-bottom:1rem;">⚡
                                            Calculadora de Consumo Energético</h3>
                                        <p style="font-size:0.85rem;color:var(--c-muted);margin-bottom:1rem;">Calcule
                                            quanto
                                            cada produto vai custar na sua conta de luz por mês/ano.</p>

                                        <div style="display:flex;flex-direction:column;gap:0.75rem;">
                                            <div>
                                                <label style="font-size:0.85rem;font-weight:500;">Tarifa de energia
                                                    (R$/kWh):</label>
                                                <input type="number" id="calc-tariff" value="0.85" step="0.01" min="0.1"
                                                    max="2"
                                                    style="padding:0.5rem;border:1px solid var(--c-border);border-radius:var(--radius-sm);width:100px;margin-left:0.5rem;">
                                            </div>
                                            <div>
                                                <label style="font-size:0.85rem;font-weight:500;">Voltagem:</label>
                                                <select id="calc-voltage"
                                                    style="padding:0.5rem;border:1px solid var(--c-border);border-radius:var(--radius-sm);margin-left:0.5rem;">
                                                    <option value="110">110V</option>
                                                    <option value="220">220V</option>
                                                    <option value="both">Bivolt</option>
                                                </select>
                                                <small
                                                    style="color:var(--c-muted);font-size:0.75rem;display:block;margin-top:0.25rem;">Nota:
                                                    consumo pode variar ~5% entre 110V e 220V</small>
                                            </div>
                                            <button class="btn" onclick="calculateEnergy()"
                                                style="margin-top:0.5rem;">Calcular Consumo</button>
                                        </div>

                                        <div id="energy-results" style="margin-top:1rem;display:none;">
                                            <!-- Results will be rendered here -->
                                        </div>
                                    </div>

                                    <!-- Niche/Fit Checker -->
                                    <div
                                        style="background:var(--c-surface);border-radius:var(--radius);padding:1.5rem;box-shadow:var(--shadow-sm);">
                                        <h3 style="color:var(--c-primary-dark);font-size:1.1rem;margin-bottom:1rem;">📐
                                            Verificador de Encaixe (Nicho)</h3>
                                        <p style="font-size:0.85rem;color:var(--c-muted);margin-bottom:1rem;">Informe as
                                            medidas do seu espaço e veja quais produtos cabem.</p>

                                        <div style="display:flex;flex-direction:column;gap:0.75rem;">
                                            <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
                                                <div>
                                                    <label style="font-size:0.85rem;font-weight:500;">Largura
                                                        (cm):</label>
                                                    <input type="number" id="niche-width" placeholder="70" min="50"
                                                        max="200"
                                                        style="padding:0.5rem;border:1px solid var(--c-border);border-radius:var(--radius-sm);width:70px;margin-left:0.25rem;">
                                                </div>
                                                <div>
                                                    <label style="font-size:0.85rem;font-weight:500;">Altura
                                                        (cm):</label>
                                                    <input type="number" id="niche-height" placeholder="180" min="100"
                                                        max="250"
                                                        style="padding:0.5rem;border:1px solid var(--c-border);border-radius:var(--radius-sm);width:70px;margin-left:0.25rem;">
                                                </div>
                                                <div>
                                                    <label style="font-size:0.85rem;font-weight:500;">Profundidade
                                                        (cm):</label>
                                                    <input type="number" id="niche-depth" placeholder="80" min="50"
                                                        max="150"
                                                        style="padding:0.5rem;border:1px solid var(--c-border);border-radius:var(--radius-sm);width:70px;margin-left:0.25rem;">
                                                </div>
                                            </div>
                                            <div>
                                                <label style="font-size:0.85rem;font-weight:500;">Folga mínima desejada
                                                    (cm):</label>
                                                <input type="number" id="niche-gap" value="4" min="0" max="20"
                                                    style="padding:0.5rem;border:1px solid var(--c-border);border-radius:var(--radius-sm);width:60px;margin-left:0.5rem;">
                                                <small
                                                    style="color:var(--c-muted);font-size:0.75rem;display:block;margin-top:0.25rem;">Recomendado:
                                                    4cm para ventilação</small>
                                            </div>
                                            <button class="btn" onclick="checkNicheFit()"
                                                style="margin-top:0.5rem;">Verificar Encaixe</button>
                                        </div>

                                        <div id="niche-results" style="margin-top:1rem;display:none;">
                                            <!-- Results will be rendered here -->
                                        </div>
                                    </div>
                                </div>
                            </section>
                    </div>

                    <!-- Individual Product Page -->
                    <div id="page-product" style="display:none;">
                        <div class="page-header">
                            <h1 class="page-title" id="product-title"></h1>
                            <p class="page-desc" id="product-subtitle"></p>
                        </div>
                        <div id="product-content"></div>
                    </div>

                    <!-- Comparison Page -->
                    <div id="page-comparison" style="display:none;">
                        <div class="page-header">
                            <h1 class="page-title" id="comparison-title">⚖️ Comparação</h1>
                            <p class="page-desc">Veja lado a lado as diferenças entre os produtos selecionados</p>
                        </div>
                        <div id="comparison-content"></div>
                    </div>
                </div>
        </main>
    </div>

    <!-- Comparison Floating Bar -->
    <div class="compare-bar" id="compare-bar" style="z-index:90;">
        <div class="compare-bar-products" id="compare-bar-products"></div>
        <div class="compare-bar-actions">
            <button class="compare-bar-btn secondary" onclick="clearComparison()">Limpar</button>
            <button class="compare-bar-btn primary" onclick="showComparison()">⚖️ Comparar</button>
        </div>
    </div>

    <!-- Floating Compare Counter Badge -->
    <div class="compare-counter" id="compare-counter" style="z-index:90;">
        <button class="compare-counter-close" onclick="hideCompareCounter()" title="Fechar">×</button>
        <div class="compare-counter-number">0</div>
        <div class="compare-counter-text">produtos</div>
        <button class="compare-counter-btn" onclick="showComparison()">Ver Comparação</button>
    </div>

    <!-- Comparison Modal -->
    <div class="compare-modal" id="compare-modal" onclick="if(event.target===this) closeCompareModal()">
        <div class="compare-modal-content">
            <div class="compare-modal-header">
                <div class="compare-modal-title-row" style="flex-wrap:nowrap;">
                    <h2 class="compare-modal-title" style="white-space:nowrap;">⚖️ Comparação Detalhada</h2>
                    <div style="display:flex;align-items:center;gap:0.5rem;flex-wrap:nowrap;">
                        <div class="font-zoom-controls">
                            <button class="font-zoom-btn" onclick="changeTableFontSize(-1)"
                                title="Diminuir fonte">A-</button>
                            <button class="font-zoom-btn" onclick="changeTableFontSize(1)"
                                title="Aumentar fonte">A+</button>
                        </div>
                    </div>
                    <div style="display:flex;align-items:center;gap:1rem;">
                        <div class="share-buttons" id="share-panel">
                            <button class="share-social-btn whatsapp" onclick="shareToSocial('whatsapp')"
                                title="WhatsApp">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                    <path
                                        d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
                                </svg>
                            </button>
                            <button class="share-social-btn telegram" onclick="shareToSocial('telegram')"
                                title="Telegram">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                    <path
                                        d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z" />
                                </svg>
                            </button>
                            <button class="share-social-btn facebook" onclick="shareToSocial('facebook')"
                                title="Facebook">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                    <path
                                        d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
                                </svg>
                            </button>
                            <button class="share-social-btn twitter" onclick="shareToSocial('twitter')"
                                title="X (Twitter)">
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                                    <path
                                        d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
                                </svg>
                            </button>
                            <button class="share-social-btn email" onclick="shareToSocial('email')" title="Email">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                    <path
                                        d="M1.5 8.67v8.58a3 3 0 003 3h15a3 3 0 003-3V8.67l-8.928 5.493a3 3 0 01-3.144 0L1.5 8.67z" />
                                    <path
                                        d="M22.5 6.908V6.75a3 3 0 00-3-3h-15a3 3 0 00-3 3v.158l9.714 5.978a1.5 1.5 0 001.572 0L22.5 6.908z" />
                                </svg>
                            </button>
                            <button class="share-social-btn copy" onclick="shareToSocial('copy')" title="Copiar Link">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                    <path
                                        d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
                                        stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" fill="none" />
                                </svg>
                            </button>
                        </div>
                        <button class="compare-modal-close" onclick="closeCompareModal()">✕</button>
                    </div>
                </div>
                <div class="compare-modal-body" id="compare-modal-body"></div>
            </div>
        </div>

        <!-- Share Toast -->
        <div class="share-toast" id="share-toast">✓ Link copiado para a área de transferência!</div>



        <script src="/js/utils.js" defer></script>
        <script src="/js/router.js" defer></script>
        <script src="/js/catalog.js" defer></script>
        <script src="/js/ranking.js" defer></script>
        <script src="/js/comparator.js" defer></script>
        <script src="/js/assistant.js" defer></script>

        <script>
            let catalog = null;
            let assistantConfig = null;
            let currentCategory = null;


            // Labels amigáveis
            const SPEC_LABELS = {
                capacidade_total: 'Capacidade Total',
                capacidade_refrigerador: 'Refrigerador',
                capacidade_freezer: 'Freezer',
                consumo_kwh: 'Consumo Mensal',
                largura_cm: 'Largura',
                altura_cm: 'Altura',
                profundidade_cm: 'Profundidade',
                peso_kg: 'Peso',
                dispenser_agua: 'Dispenser de Água',
                tipo: 'Tipo',
                frost_free: 'Frost Free',
                cor: 'Cor',
                selo_procel: 'Selo Procel'
            };

            const SPEC_UNITS = {
                capacidade_total: 'L',
                capacidade_refrigerador: 'L',
                capacidade_freezer: 'L',
                consumo_kwh: 'kWh/mês',
                largura_cm: 'cm',
                altura_cm: 'cm',
                profundidade_cm: 'cm',
                peso_kg: 'kg'
            };

            // Sidebar functions - EXPLICIT STATE MANAGEMENT
            function openSidebar() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebar-overlay');
                sidebar.classList.add('open');
                if (overlay) overlay.classList.add('open');
                document.body.style.overflow = 'hidden'; // Lock scroll
            }

            function closeSidebar() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebar-overlay');
                if (sidebar) sidebar.classList.remove('open');
                if (overlay) overlay.classList.remove('open');
                document.body.style.overflow = ''; // Unlock scroll
            }

            // Font size zoom for comparison table
            let currentTableFontSize = 12; // base size in px
            function changeTableFontSize(delta) {
                const table = document.querySelector('.compare-table');
                if (!table) {
                    console.log('changeTableFontSize: table not found');
                    return;
                }

                currentTableFontSize = Math.max(8, Math.min(20, currentTableFontSize + delta));
                table.style.fontSize = currentTableFontSize + 'px';

                // Also adjust cell padding proportionally
                const cells = table.querySelectorAll('th, td');
                const padding = Math.max(3, Math.min(12, currentTableFontSize / 3));
                cells.forEach(cell => {
                    cell.style.padding = `${padding}px ${padding * 1.2}px`;
                });
                console.log('Font size changed to:', currentTableFontSize);
            }

            // Hide the compare counter badge
            function hideCompareCounter() {
                const counter = document.getElementById('compare-counter');
                if (counter) {
                    counter.style.display = 'none';
                    counter.classList.remove('show');
                }
            }

            // Combined Toggle function (referenced by HTML onclick)
            function toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                if (sidebar && sidebar.classList.contains('open')) {
                    closeSidebar();
                } else {
                    openSidebar();
                }
            }

            // Handle overlay click - just closes the sidebar
            function handleOverlayClick() {
                closeSidebar();
                hideCompareToast();
            }

            // Show the compare toast (small notification in bottom right)
            function showComparePrompt() {
                const prompt = document.getElementById('compare-prompt');
                const productsContainer = document.getElementById('compare-prompt-products');
                const hint = document.getElementById('compare-prompt-hint');
                const compareBtn = document.getElementById('compare-prompt-btn-compare');
                const counter = document.getElementById('compare-counter');

                if (!prompt || !productsContainer || compareList.length === 0) {
                    hideCompareToast();
                    return;
                }

                // Hide counter while toast is visible (using inline style to override any previous inline display)
                if (counter) {
                    counter.classList.remove('show');
                    counter.style.display = 'none';
                }

                // Render selected products
                productsContainer.innerHTML = compareList.map(p => `
                <div class="compare-prompt-product">
                    <span>✓ ${p.brand} ${p.model}</span>
                    <span style="color:#10b981;font-weight:600">${p.score}</span>
                </div>
            `).join('');

                // Update hint and button state
                const remaining = 4 - compareList.length;
                if (compareList.length < 2) {
                    hint.textContent = `+${2 - compareList.length} para comparar`;
                    hint.style.color = '#f59e0b';
                    compareBtn.classList.add('disabled');
                    compareBtn.disabled = true;
                } else {
                    hint.textContent = remaining > 0 ? `+${remaining} disponível` : 'Máximo atingido';
                    hint.style.color = '#64748b';
                    compareBtn.classList.remove('disabled');
                    compareBtn.disabled = false;
                }

                prompt.classList.add('show');
            }

            // Hide the compare toast and show counter if there are products
            function hideCompareToast() {
                const prompt = document.getElementById('compare-prompt');
                const counter = document.getElementById('compare-counter');

                if (prompt) prompt.classList.remove('show');

                // Show counter with updated count when toast is hidden
                if (counter && compareList.length > 0) {
                    const numberEl = counter.querySelector('.compare-counter-number');
                    const textEl = counter.querySelector('.compare-counter-text');
                    if (numberEl) numberEl.textContent = compareList.length;
                    if (textEl) textEl.textContent = compareList.length === 1 ? 'produto' : 'produtos';
                    counter.style.display = 'flex';
                    counter.classList.add('show');
                }
            }

            // Close the compare prompt modal
            function closeComparePrompt() {
                hideCompareToast();
            }

            // Start comparison from the prompt
            function startComparisonFromPrompt() {
                hideCompareToast();
                closeSidebar();

                // Call existing comparison function if available
                if (typeof showComparison === 'function') {
                    showComparison();
                }
            }

            // Safety: Attach listeners on load to ensure buttons work even if inline onclick fails
            document.addEventListener('DOMContentLoaded', () => {
                const menuBtn = document.querySelector('.mobile-menu-btn');
                if (menuBtn) {
                    menuBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopImmediatePropagation();
                        toggleSidebar();
                    });
                }
            });

            // Global Router Helper that closes sidebar on mobile
            window.navigate = function (path) {
                if (window.innerWidth <= 1024) closeSidebar();
                Router.navigate(path);
            };

            // Navigate to product page from sidebar
            function navigateToProduct(categorySlug, productId) {
                // Use the existing showProduct function which handles everything
                showProduct(categorySlug, productId);

                // Update URL without reload
                const url = `/produto/${categorySlug}/${productId}`;
                history.pushState({ page: 'product', category: categorySlug, product: productId }, '', url);
            }

            function toggleCategory(el) {
                el.classList.toggle('open');
            }

            function showHome() {
                document.getElementById('page-home').style.display = 'block';
                document.getElementById('page-category').style.display = 'none';
                document.getElementById('page-product').style.display = 'none';
                document.getElementById('page-comparison').style.display = 'none';
                document.getElementById('header-title').textContent = 'Bem-vindo ao ComparaTop';
                document.getElementById('breadcrumb').innerHTML = '<a href="#" onclick="showHome(); return false;">Início</a>';

                // Update active states - clear all selections
                document.querySelectorAll('.nav-subcategory').forEach(el => el.classList.remove('active'));
                document.querySelectorAll('.nav-category-header').forEach(el => el.classList.remove('active'));
                document.querySelectorAll('.nav-product-item').forEach(el => el.classList.remove('active'));
                document.querySelector('.sidebar-nav > .nav-category-header').classList.add('active');

                if (window.innerWidth <= 1024) closeSidebar();
            }

            async function showCategory(categoryId) {

                currentCategory = categoryId;

                // Scroll to top when navigating to category
                window.scrollTo(0, 0);
                document.querySelector('.main-content')?.scrollTo(0, 0);

                document.getElementById('page-home').style.display = 'none';
                document.getElementById('page-category').style.display = 'block';
                document.getElementById('page-product').style.display = 'none';
                document.getElementById('page-comparison').style.display = 'none';
                document.getElementById('loading').style.display = 'block';
                document.getElementById('products-grid').innerHTML = '';
                document.getElementById('error').style.display = 'none';

                const categoryNames = {
                    geladeira: 'Geladeiras',
                    freezer: 'Freezers',
                    frigobar: 'Frigobares'
                };

                const categoryName = categoryNames[categoryId] || categoryId;
                document.getElementById('header-title').textContent = categoryName;
                document.getElementById('category-title').textContent = categoryName;
                document.getElementById('breadcrumb').innerHTML = `
                <a href="#" onclick="showHome(); return false;">Início</a> / 
                <a href="#" onclick="showCategory('${categoryId}'); return false;">${categoryName}</a>
            `;

                // Update active states
                document.querySelectorAll('.nav-subcategory').forEach(el => el.classList.remove('active'));
                document.querySelectorAll('.nav-category-header').forEach(el => el.classList.remove('active'));

                if (window.innerWidth <= 1024) closeSidebar();

                try {
                    // Load catalog directly via fetch (more reliable than module)
                    const catalogResp = await fetch(`/data/catalogs/${categoryId}.json`);
                    if (!catalogResp.ok) {
                        throw new Error(`Catalog fetch failed: ${catalogResp.status}`);
                    }
                    currentCatalog = await catalogResp.json();
                    catalog = currentCatalog;

                    // Load assistant config (optional, don't fail if missing)
                    try {
                        const assistantResp = await fetch(`/data/assistant/${categoryId}.json`);
                        if (assistantResp.ok) {
                            assistantConfig = await assistantResp.json();
                        }
                    } catch (e) {
                        console.warn('Assistant config not available:', e);
                    }

                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('error').style.display = 'none';
                    renderProducts();

                } catch (err) {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('error').textContent = '❌ Erro ao carregar catálogo. Por favor, recarregue a página.';
                    document.getElementById('error').style.display = 'block';
                    console.error('showCategory error:', err);
                }
            }

            function formatSpec(key, value) {
                if (value === null || value === undefined) return 'N/A';
                if (typeof value === 'boolean') return value ? 'Sim' : 'Não';
                if (Array.isArray(value)) return value.join(', ');
                const unit = SPEC_UNITS[key] || '';
                return `${value}${unit ? ' ' + unit : ''}`;
            }

            function renderProducts() {
                // Get products directly from currentCatalog
                const products = currentCatalog && currentCatalog.products
                    ? Object.values(currentCatalog.products).filter(p => p.status === 'active')
                    : [];
                const container = document.getElementById('products-grid');

                container.innerHTML = products.map(product => `
                <article class="product-card">
                    <div class="product-header">
                        <div>
                            <div class="product-brand">${product.brand}</div>
                            <div class="product-name">${product.model}</div>
                        </div>
                        <div class="product-score">${product.editorialScores.overall}/10</div>
                    </div>
                    
                    <!-- Specs principais -->
                    <div class="specs-grid">
                        ${['capacidade_total', 'capacidade_freezer', 'consumo_kwh', 'largura_cm'].map(key => `
                            <div class="spec-item">
                                <span class="spec-label">${SPEC_LABELS[key] || key}</span>
                                <span class="spec-value">${formatSpec(key, product.specs[key])}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <!-- Todas as ofertas -->
                    <h4 style="font-size:0.95rem;margin:1rem 0 0.5rem;color:var(--c-primary-dark);">🛒 Onde comprar (menor → maior)</h4>
                    <div class="offers-list">
                        ${renderOffers(product)}
                    </div>
                    
                    <!-- Editorial Scores -->
                    <details style="margin-top:1rem;">
                        <summary style="cursor:pointer;font-weight:600;font-size:0.9rem;color:var(--c-primary);">📊 Notas Editoriais (0-10)</summary>
                        <div class="editorial-scores">
                            ${renderEditorialScores(product)}
                        </div>
                    </details>
                    
                    <!-- VoC Section -->
                    <details style="margin-top:1rem;" open>
                        <summary style="cursor:pointer;font-weight:600;font-size:0.9rem;color:var(--c-primary);">🗣️ Voz do Cliente (síntese de ${product.voc?.sample?.totalApprox?.toLocaleString('pt-BR') || '?'} avaliações)</summary>
                        <div class="voc-section" style="margin-top:0.5rem;box-shadow:none;padding:1rem;">
                            ${renderVoC(product)}
                        </div>
                    </details>
                    
                    <!-- Compare Button - PROMINENT -->
                    <button class="compare-btn" data-product-id="${product.id}" onclick="toggleCompare('${product.id}', '${product.name}')">
                        ⚖️ Comparar este produto
                    </button>
                    
                    <!-- View Product Details Button -->
                    <a href="/produto/geladeira/${product.id}" 
                       onclick="event.preventDefault(); navigateToProduct('geladeira', '${product.id}');" 
                       class="btn" 
                       style="display:block;text-align:center;margin-top:0.5rem;background:var(--c-primary);color:#fff;text-decoration:none;">
                        📋 Ver Ficha Técnica Completa
                    </a>
                </article>
            `).join('');
            }

            function renderOffers(product) {
                if (!product.offers || !product.offers.length) {
                    return '<p style="color:var(--c-muted);font-size:0.9rem;">Sem ofertas disponíveis</p>';
                }

                const sorted = [...product.offers]
                    .filter(o => o.url)
                    .sort((a, b) => {
                        if (a.price == null) return 1;
                        if (b.price == null) return -1;
                        return a.price - b.price;
                    });

                let latestUpdate = '';
                const html = sorted.map(offer => {
                    const priceText = offer.price ? Utils.formatBRL(offer.price) : 'Ver preço';
                    if (offer.lastUpdated && (!latestUpdate || offer.lastUpdated > latestUpdate)) {
                        latestUpdate = offer.lastUpdated;
                    }
                    return `
                    <a href="${offer.url}" class="offer-btn ${offer.retailerId}" target="_blank" rel="sponsored nofollow noopener">
                        <span class="retailer">${offer.retailerName}</span>
                        <span class="price">${priceText}</span>
                    </a>
                `;
                }).join('');

                const updateText = latestUpdate
                    ? `<div class="offers-updated">Atualizado: ${Utils.formatDateTime(latestUpdate)}</div>`
                    : '';

                return html + updateText;
            }

            function renderEditorialScores(product) {
                const scores = product.editorialScores;
                const topics = catalog.scoringTopics || [];

                return topics.map(topic => {
                    const score = scores[topic.id];
                    if (score == null) return '';

                    const barWidth = score * 10;
                    let barClass = 'medium';
                    if (score >= 8) barClass = 'high';
                    else if (score < 6) barClass = 'low';

                    return `
                    <div class="editorial-topic">
                        <span style="font-size:1rem;">${topic.icon || '📊'}</span>
                        <span class="editorial-topic-label">${topic.label}</span>
                        <span class="editorial-topic-score">${score.toFixed(1)}</span>
                        <div class="editorial-topic-bar">
                            <div class="editorial-topic-bar-fill ${barClass}" style="width:${barWidth}%"></div>
                        </div>
                    </div>
                `;
                }).join('');
            }

            function renderVoC(product) {
                const voc = product.voc;
                if (!voc) {
                    return '<p style="color:var(--c-muted);">Dados de VoC não disponíveis.</p>';
                }

                let html = '';

                // Badge de sentimento
                html += `<span class="voc-badge ${voc.sentimentClass || 'mixed'}">${voc.sentiment}</span>`;

                // One-liner
                html += `<div class="voc-oneliner">${voc.oneLiner}</div>`;

                // Resumo 30s
                if (voc.summary30s) {
                    html += `<div class="voc-summary"><strong>📖 Resumo em 30s:</strong> ${voc.summary30s}</div>`;
                }

                // Pros e Cons
                html += '<div class="voc-lists">';

                // Pros
                html += '<div class="voc-list">';
                html += '<div class="voc-list-title pros">👍 Elogios mais recorrentes</div>';
                html += '<ul>';
                (voc.pros || []).slice(0, 4).forEach(pro => {
                    html += `<li>
                    <span class="topic">${pro.topic}</span>
                    <span class="freq">${pro.freq}</span>
                    <span class="detail">${pro.detail}</span>
                </li>`;
                });
                html += '</ul></div>';

                // Cons
                html += '<div class="voc-list">';
                html += '<div class="voc-list-title cons">👎 Reclamações mais recorrentes</div>';
                html += '<ul>';
                (voc.cons || []).slice(0, 4).forEach(con => {
                    html += `<li>
                    <span class="topic">${con.topic}</span>
                    <span class="freq">${con.freq}</span>
                    <span class="detail">${con.detail}</span>
                </li>`;
                });
                html += '</ul></div>';

                html += '</div>';

                // Sample e Sources
                html += '<div class="voc-sample">';
                html += `<strong>📊 Amostra analisada:</strong> ~${voc.sample?.totalApprox?.toLocaleString('pt-BR') || '?'} avaliações`;
                if (voc.sample?.breakdown) {
                    html += '<br><small>';
                    html += voc.sample.breakdown.map(b => `${b.source}: ~${(b.count || b.countApprox || 0).toLocaleString('pt-BR')}`).join(' · ');
                    html += '</small>';
                }
                html += '</div>';

                if (voc.sources && voc.sources.length) {
                    html += '<div class="voc-sources"><strong>🔗 Fontes:</strong> ';
                    html += voc.sources.slice(0, 5).map(s => `<a href="${s.url}" target="_blank" rel="nofollow noopener">${s.name}</a>`).join('');
                    html += '</div>';
                }

                return html;
            }

            function runAssistant() {
                if (!catalog) return;

                const answers = {
                    niche_width: parseFloat(document.getElementById('q-niche').value) || null,
                    budget_min: parseFloat(document.getElementById('q-budget-min').value) || null,
                    budget_max: parseFloat(document.getElementById('q-budget-max').value) || null,
                    freezer_usage: document.getElementById('q-freezer').value,
                    priority: document.getElementById('q-priority').value,
                    noise_sensitive: document.getElementById('q-noise').value
                };

                const products = Catalog.getProducts(catalog);
                const scored = products.map(product => {
                    let score = (product.editorialScores?.overall || 5) * 10;
                    const reasons = [];
                    const warnings = [];

                    // Verifica nicho
                    if (answers.niche_width) {
                        const gap = 4;
                        const needed = product.specs.largura_cm + gap;
                        if (answers.niche_width >= needed) {
                            reasons.push(`Cabe no seu nicho de ${answers.niche_width} cm`);
                            score += 20;
                        } else {
                            warnings.push(`Não cabe no espaço (precisa ${needed} cm)`);
                            score -= 100;
                        }
                    }

                    // Verifica orçamento
                    if (answers.budget_max && product.bestPrice) {
                        if (product.bestPrice > answers.budget_max) {
                            warnings.push(`Acima do orçamento máximo (${Utils.formatBRL(product.bestPrice)})`);
                            score -= 50;
                        } else if (answers.budget_min && product.bestPrice < answers.budget_min) {
                            // Dentro do range
                        } else {
                            const savings = answers.budget_max - product.bestPrice;
                            if (savings > 200) {
                                reasons.push(`${Utils.formatBRL(savings)} abaixo do orçamento`);
                            }
                        }
                    }

                    // Prioridade
                    switch (answers.priority) {
                        case 'consumo':
                            const consumoScore = product.editorialScores.consumo || 5;
                            score += consumoScore * 3;
                            if (consumoScore >= 8) reasons.push(`Destaque em consumo energético`);
                            break;
                        case 'freezer':
                            const freezerL = product.specs.capacidade_freezer || 0;
                            score += freezerL * 0.5;
                            if (freezerL >= 100) reasons.push(`Freezer grande (${freezerL}L)`);
                            break;
                        case 'funcoes':
                            const funcScore = product.editorialScores.funcionalidades || 5;
                            score += funcScore * 3;
                            if (funcScore >= 8) reasons.push(`Destaque em funcionalidades`);
                            break;
                        case 'espaco':
                            score += (100 - product.specs.largura_cm) * 0.5;
                            reasons.push(`Largura: ${product.specs.largura_cm} cm`);
                            break;
                        case 'custo':
                            if (product.bestPrice) {
                                score += (10000 / product.bestPrice) * 10;
                            }
                            break;
                    }

                    // Freezer usage
                    if (answers.freezer_usage === 'muito') {
                        score += (product.specs.capacidade_freezer || 0) * 0.3;
                    }

                    // Ruído
                    if (answers.noise_sensitive === 'sim') {
                        const ruidoScore = product.editorialScores.ruido || 5;
                        score += ruidoScore * 2;
                        if (ruidoScore < 6) {
                            warnings.push(`VoC indica reclamações frequentes de ruído`);
                        }
                    }

                    // IdealFor como bônus
                    (product.idealFor || []).slice(0, 2).forEach(ideal => {
                        if (!reasons.some(r => r.includes(ideal.label))) {
                            reasons.push(ideal.label);
                        }
                    });

                    return { product, score, reasons: reasons.slice(0, 4), warnings };
                });

                scored.sort((a, b) => b.score - a.score);

                const container = document.getElementById('assistant-results');

                let html = '<h4 style="margin-bottom:1rem;color:var(--c-primary-dark);">📋 Recomendações para você:</h4>';

                scored.forEach((item, index) => {
                    const isWinner = index === 0;
                    html += `
                    <div class="result-card ${isWinner ? 'winner' : ''}">
                        <div class="result-header">
                            <div>
                                <h4 style="margin:0;">${index + 1}. ${item.product.name}</h4>
                                <p style="color:var(--c-muted);font-size:0.9rem;margin:0.25rem 0;">
                                    Nota geral: ${item.product.editorialScores.overall}/10 · 
                                    Score personalizado: ${item.score.toFixed(0)} pts
                                </p>
                            </div>
                        </div>
                        
                        ${item.reasons.length ? `
                            <ul class="result-reasons">
                                ${item.reasons.map(r => `<li>${r}</li>`).join('')}
                            </ul>
                        ` : ''}
                        
                        ${item.warnings.length ? `
                            <div class="result-warnings">
                                ⚠️ ${item.warnings.join(' · ')}
                            </div>
                        ` : ''}
                        
                        <!-- TODAS as ofertas, ordenadas -->
                        <h5 style="margin:1rem 0 0.5rem;font-size:0.9rem;">🛒 Onde comprar:</h5>
                        <div class="offers-list">
                            ${renderOffers(item.product)}
                        </div>
                    </div>
                `;
                });

                container.innerHTML = html;
                container.classList.add('show');

                // Scroll to results
                container.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            // ==================== SEARCH ====================
            let searchTimeout = null;
            const searchInput = document.getElementById('search-input');
            const searchResults = document.getElementById('search-results');

            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                const query = e.target.value.trim();

                if (query.length < 1) {
                    searchResults.classList.remove('show');
                    return;
                }

                searchTimeout = setTimeout(() => performSearch(query), 300);
            });

            searchInput.addEventListener('focus', () => {
                if (searchInput.value.length >= 1) {
                    searchResults.classList.add('show');
                }
            });

            // Handle Enter key to go to first result
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const firstResult = searchResults.querySelector('.search-result-item');
                    if (firstResult) {
                        firstResult.click();
                    } else if (searchInput.value.trim().length >= 1) {
                        // Trigger search and wait for results
                        performSearch(searchInput.value.trim()).then(() => {
                            const result = searchResults.querySelector('.search-result-item');
                            if (result) result.click();
                        });
                    }
                }
            });

            document.addEventListener('click', (e) => {
                if (!e.target.closest('.search-container')) {
                    searchResults.classList.remove('show');
                }
            });

            // Keyboard shortcut
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    searchInput.focus();
                }
                if (e.key === 'Escape') {
                    searchResults.classList.remove('show');
                    searchInput.blur();
                }
            });

            async function performSearch(query) {
                // Search across all categories
                const categories = ['geladeira'];
                let allProducts = [];

                for (const cat of categories) {
                    try {
                        const catCatalog = await Catalog.load(cat);
                        const products = Catalog.getProducts(catCatalog);
                        allProducts = allProducts.concat(products.map(p => ({ ...p, category: cat })));
                    } catch (e) {
                        // Category not available
                    }
                }

                const q = query.toLowerCase();
                const results = allProducts.filter(p =>
                    p.name.toLowerCase().includes(q) ||
                    p.brand.toLowerCase().includes(q) ||
                    p.model.toLowerCase().includes(q) ||
                    (p.tags || []).some(t => t.toLowerCase().includes(q))
                ).slice(0, 8);

                renderSearchResults(results, query);
            }

            function renderSearchResults(results, query) {
                if (results.length === 0) {
                    searchResults.innerHTML = `
                    <div class="search-no-results">
                        <p>Nenhum produto encontrado para "${query}"</p>
                    </div>
                `;
                } else {
                    searchResults.innerHTML = results.map(p => `
                    <div class="search-result-item" onclick="goToProduct('${p.category}', '${p.id}')">
                        <div class="search-result-info">
                            <div class="search-result-name">${p.brand} ${p.model}</div>
                            <div class="search-result-brand">${p.name}</div>
                        </div>
                        <span class="search-result-score">${p.editorialScores?.overall || '?'}/10</span>
                    </div>
                `).join('');
                }
                searchResults.classList.add('show');
            }

            function goToProduct(category, productId) {
                searchResults.classList.remove('show');
                searchInput.value = '';
                showProduct(category, productId);
            }

            // ==================== N-WAY COMPARISON ====================
            let compareList = [];
            const MAX_COMPARE = 4;

            // Called from product page compare button
            function toggleProductCompare(productId) {
                if (!currentCatalog) return;
                const products = Catalog.getProducts(currentCatalog);
                const product = products.find(p => p.id === productId);
                if (!product) return;

                const index = compareList.findIndex(p => p.id === productId);

                if (index > -1) {
                    compareList.splice(index, 1);
                } else {
                    if (compareList.length >= MAX_COMPARE) {
                        alert(`Máximo de ${MAX_COMPARE} produtos para comparação`);
                        return;
                    }
                    compareList.push(product);
                }

                // Update button state
                const btn = document.getElementById(`compare-btn-${productId}`);
                if (btn) {
                    const isInCompare = compareList.some(p => p.id === productId);
                    btn.textContent = isInCompare ? '✓ Na comparação' : '➕ Adicionar ao comparador';
                    btn.classList.toggle('btn-compare-active', isInCompare);
                }

                updateCompareUI();
            }

            function toggleCompare(productId, productName) {
                const index = compareList.findIndex(p => p.id === productId);

                if (index > -1) {
                    compareList.splice(index, 1);
                } else {
                    if (compareList.length >= MAX_COMPARE) {
                        alert(`Máximo de ${MAX_COMPARE} produtos para comparação`);
                        return;
                    }
                    const products = Catalog.getProducts(catalog);
                    const product = products.find(p => p.id === productId);
                    if (product) {
                        compareList.push(product);
                    }
                }

                updateCompareUI();
            }

            function updateCompareUI() {
                // Update buttons
                document.querySelectorAll('.compare-btn').forEach(el => {
                    const id = el.dataset.productId;
                    const isSelected = compareList.some(p => p.id === id);
                    el.classList.toggle('selected', isSelected);
                    el.textContent = isSelected ? '✓ Selecionado para comparação' : '⚖️ Comparar este produto';
                });

                // Update floating bar (but NOT the counter - that's managed by showComparePrompt/hideCompareToast)
                const bar = document.getElementById('compare-bar');
                const productsContainer = document.getElementById('compare-bar-products');
                const counter = document.getElementById('compare-counter');

                if (compareList.length > 0) {
                    bar.classList.add('show');
                    // Don't show counter here - let hideCompareToast handle it

                    // Update counter number (but don't show it yet)
                    if (counter) {
                        const numberEl = counter.querySelector('.compare-counter-number');
                        const textEl = counter.querySelector('.compare-counter-text');
                        if (numberEl) numberEl.textContent = compareList.length;
                        if (textEl) textEl.textContent = compareList.length === 1 ? 'produto' : 'produtos';
                    }

                    productsContainer.innerHTML = compareList.map(p => `
                    <div class="compare-bar-product">
                        <span class="compare-bar-product-name">${p.brand} ${p.model}</span>
                        <button class="compare-bar-remove" onclick="toggleCompare('${p.id}', '${p.name}')">✕</button>
                    </div>
                `).join('');
                } else {
                    bar.classList.remove('show');
                    if (counter) counter.classList.remove('show');
                }
            }

            function clearComparison() {
                compareList = [];
                updateCompareUI();
            }

            function showComparison() {
                if (compareList.length < 2) {
                    alert('Selecione pelo menos 2 produtos para comparar');
                    return;
                }

                const modal = document.getElementById('compare-modal');
                const body = document.getElementById('compare-modal-body');

                body.innerHTML = renderComparisonTable();
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }

            function closeCompareModal() {
                document.getElementById('compare-modal').classList.remove('show');
                document.body.style.overflow = '';
            }

            function renderComparisonTable() {
                const products = compareList;
                const specsToCompare = [
                    'capacidade_total', 'capacidade_freezer', 'consumo_kwh',
                    'largura_cm', 'altura_cm', 'profundidade_cm', 'peso_kg'
                ];
                const topics = currentCatalog?.scoringTopics || [];

                // Find winners for each spec
                function findWinner(spec, higherIsBetter = true) {
                    const values = products.map(p => p.specs[spec] || 0);
                    const best = higherIsBetter ? Math.max(...values) : Math.min(...values);
                    return products.filter(p => (p.specs[spec] || 0) === best).map(p => p.id);
                }

                function findScoreWinner(topicId) {
                    const values = products.map(p => {
                        const val = p.editorialScores?.[topicId];
                        return typeof val === 'object' ? val?.score : val;
                    });
                    const best = Math.max(...values.filter(v => typeof v === 'number'));
                    return products.filter(p => {
                        const val = p.editorialScores?.[topicId];
                        const score = typeof val === 'object' ? val?.score : val;
                        return score === best;
                    }).map(p => p.id);
                }

                let html = '<table class="compare-table">';

                // Header with product names
                html += '<thead><tr><th></th>';
                products.forEach(p => {
                    html += `<th class="product-cell">
                    <div class="product-brand">${p.brand}</div>
                    <div class="product-name">${p.model}</div>
                    <span class="score-badge">${p.editorialScores?.overall || '?'}/10</span>
                </th>`;
                });
                html += '</tr></thead>';

                html += '<tbody>';

                // Price row - clickable with affiliate link + marketplace name
                const priceWinners = products.filter(p => p.bestPrice === Math.min(...products.map(x => x.bestPrice || Infinity))).map(p => p.id);
                html += '<tr><td><strong>💰 Melhor Preço</strong></td>';
                products.forEach(p => {
                    const isWinner = priceWinners.includes(p.id);
                    const bestOffer = p.offers?.filter(o => o.url).sort((a, b) => (a.price || Infinity) - (b.price || Infinity))[0];
                    const marketplace = bestOffer?.retailerName || bestOffer?.vendor || 'Loja';
                    const priceHtml = p.bestPrice
                        ? (bestOffer?.url
                            ? `<a href="${bestOffer.url}" target="_blank" rel="sponsored nofollow noopener" style="color:inherit;text-decoration:underline;font-weight:700;">${Utils.formatBRL(p.bestPrice)}</a><br><small style="font-size:0.75rem;color:var(--c-muted);">via ${marketplace}</small>`
                            : `${Utils.formatBRL(p.bestPrice)}<br><small style="font-size:0.75rem;color:var(--c-muted);">via ${marketplace}</small>`)
                        : 'N/A';
                    html += `<td class="${isWinner ? 'winner' : ''}">${priceHtml}</td>`;
                });
                html += '</tr>';

                // Specs section
                html += '<tr class="compare-section-header"><td colspan="' + (products.length + 1) + '">📐 Especificações</td></tr>';

                specsToCompare.forEach(spec => {
                    const higherBetter = ['capacidade_total', 'capacidade_freezer'].includes(spec);
                    const lowerBetter = ['consumo_kwh', 'peso_kg'].includes(spec);
                    const winners = lowerBetter ? findWinner(spec, false) : (higherBetter ? findWinner(spec, true) : []);

                    html += `<tr><td>${SPEC_LABELS[spec] || spec}</td>`;
                    products.forEach(p => {
                        const isWinner = winners.includes(p.id);
                        html += `<td class="${isWinner ? 'winner' : ''}">${formatSpec(spec, p.specs[spec])}</td>`;
                    });
                    html += '</tr>';
                });

                // Editorial scores section
                html += '<tr class="compare-section-header"><td colspan="' + (products.length + 1) + '">📊 Notas Editoriais</td></tr>';

                topics.forEach(topic => {
                    const winners = findScoreWinner(topic.id);
                    html += `<tr><td>${topic.icon || '📊'} ${topic.label}</td>`;
                    products.forEach(p => {
                        const scoreData = p.editorialScores?.[topic.id];
                        const score = typeof scoreData === 'object' ? scoreData?.score : scoreData;
                        const isWinner = winners.includes(p.id);
                        html += `<td class="${isWinner ? 'winner' : ''}">${score ? score.toFixed(1) : 'N/A'}</td>`;
                    });
                    html += '</tr>';
                });

                // VoC summary
                html += '<tr class="compare-section-header"><td colspan="' + (products.length + 1) + '">🗣️ Voz do Cliente</td></tr>';

                // VoC Overall Score
                html += '<tr><td>📊 Nota Geral VoC</td>';
                products.forEach(p => {
                    // Calculate VoC score from pros/cons balance + sentiment
                    let vocScore = 5; // Base
                    if (p.voc) {
                        const prosCount = p.voc.pros?.length || 0;
                        const consCount = p.voc.cons?.length || 0;
                        const balance = prosCount - consCount;
                        vocScore += balance * 0.5;
                        if (p.voc.sentimentClass === 'positive') vocScore += 1.5;
                        else if (p.voc.sentimentClass === 'negative') vocScore -= 1.5;
                        vocScore = Math.max(1, Math.min(10, vocScore));
                    }
                    html += `<td>${vocScore.toFixed(1)}/10</td>`;
                });
                html += '</tr>';

                html += '<tr><td>Sentimento</td>';
                products.forEach(p => {
                    html += `<td>${p.voc?.sentiment || 'N/A'}</td>`;
                });
                html += '</tr>';

                html += '</tbody></table>';

                return html;
            }
            // ==================== CALCULATORS ====================

            function calculateEnergy() {
                if (!catalog) {
                    alert('Por favor, selecione uma categoria primeiro');
                    return;
                }

                const tariff = parseFloat(document.getElementById('calc-tariff').value) || 0.85;
                const voltage = document.getElementById('calc-voltage').value;
                const products = Catalog.getProducts(catalog);

                const container = document.getElementById('energy-results');

                let html = '<div style="background:#f0f9ff;padding:1rem;border-radius:var(--radius-sm);margin-top:1rem;">';
                html += '<h4 style="margin-bottom:0.75rem;font-size:0.95rem;color:var(--c-primary-dark);">💡 Custo Estimado de Energia</h4>';
                html += '<table style="width:100%;font-size:0.85rem;border-collapse:collapse;">';
                html += '<tr style="border-bottom:1px solid var(--c-border);">';
                html += '<th style="text-align:left;padding:0.5rem;">Produto</th>';
                html += '<th style="text-align:right;padding:0.5rem;">kWh/mês</th>';
                html += '<th style="text-align:right;padding:0.5rem;">R$/mês</th>';
                html += '<th style="text-align:right;padding:0.5rem;">R$/ano</th>';
                html += '</tr>';

                // Sort by consumption (lowest first)
                const sorted = [...products].sort((a, b) =>
                    (a.specs.consumo_kwh || 999) - (b.specs.consumo_kwh || 999)
                );

                sorted.forEach((p, i) => {
                    let consumption = p.specs.consumo_kwh || 0;
                    // Voltage adjustment (~5% difference)
                    if (voltage === '220') consumption *= 0.95;
                    else if (voltage === '110') consumption *= 1.02;

                    const monthly = consumption * tariff;
                    const yearly = monthly * 12;
                    const isBest = i === 0;

                    html += `<tr style="border-bottom:1px solid var(--c-border);${isBest ? 'background:#dcfce7;' : ''}">`;
                    html += `<td style="padding:0.5rem;${isBest ? 'font-weight:600;' : ''}">${p.model}${isBest ? ' ⭐' : ''}</td>`;
                    html += `<td style="text-align:right;padding:0.5rem;">${consumption.toFixed(1)}</td>`;
                    html += `<td style="text-align:right;padding:0.5rem;font-weight:500;">R$ ${monthly.toFixed(2)}</td>`;
                    html += `<td style="text-align:right;padding:0.5rem;">R$ ${yearly.toFixed(2)}</td>`;
                    html += '</tr>';
                });

                html += '</table>';
                html += `<p style="font-size:0.75rem;color:var(--c-muted);margin-top:0.5rem;">Tarifa: R$ ${tariff.toFixed(2)}/kWh | Voltagem: ${voltage === 'both' ? 'Bivolt' : voltage + 'V'}</p>`;
                html += '</div>';

                container.innerHTML = html;
                container.style.display = 'block';
            }

            function checkNicheFit() {
                if (!catalog) {
                    alert('Por favor, selecione uma categoria primeiro');
                    return;
                }

                const nicheWidth = parseFloat(document.getElementById('niche-width').value);
                const nicheHeight = parseFloat(document.getElementById('niche-height').value);
                const nicheDepth = parseFloat(document.getElementById('niche-depth').value);
                const gap = parseFloat(document.getElementById('niche-gap').value) || 4;

                if (!nicheWidth && !nicheHeight && !nicheDepth) {
                    alert('Por favor, informe pelo menos uma medida');
                    return;
                }

                const products = Catalog.getProducts(catalog);
                const container = document.getElementById('niche-results');

                let html = '<div style="margin-top:1rem;">';

                products.forEach(p => {
                    const specs = p.specs;
                    const fits = {
                        width: !nicheWidth || (specs.largura_cm + gap <= nicheWidth),
                        height: !nicheHeight || (specs.altura_cm <= nicheHeight),
                        depth: !nicheDepth || (specs.profundidade_cm + gap <= nicheDepth)
                    };
                    const allFit = fits.width && fits.height && fits.depth;

                    const bgColor = allFit ? '#dcfce7' : '#fee2e2';
                    const icon = allFit ? '✅' : '❌';
                    const textColor = allFit ? '#166534' : '#991b1b';

                    html += `<div style="background:${bgColor};padding:1rem;border-radius:var(--radius-sm);margin-bottom:0.5rem;">`;
                    html += `<div style="display:flex;justify-content:space-between;align-items:center;">`;
                    html += `<strong style="color:${textColor};">${icon} ${p.model}</strong>`;
                    html += `<span style="font-size:0.85rem;color:var(--c-muted);">${allFit ? 'CABE!' : 'NÃO CABE'}</span>`;
                    html += `</div>`;

                    html += `<div style="font-size:0.85rem;margin-top:0.5rem;color:var(--c-text);">`;
                    html += `<span style="margin-right:1rem;">${fits.width ? '✓' : '✗'} Largura: ${specs.largura_cm} cm ${nicheWidth ? `(precisa ${specs.largura_cm + gap} cm)` : ''}</span>`;
                    html += `<span style="margin-right:1rem;">${fits.height ? '✓' : '✗'} Altura: ${specs.altura_cm} cm</span>`;
                    html += `<span>${fits.depth ? '✓' : '✗'} Profundidade: ${specs.profundidade_cm} cm ${nicheDepth ? `(precisa ${specs.profundidade_cm + gap} cm)` : ''}</span>`;
                    html += `</div>`;
                    html += `</div>`;
                });

                html += '</div>';

                container.innerHTML = html;
                container.style.display = 'block';
            }

            // ==================== SHARE COMPARISON ====================
            function getShareUrl() {
                const productIds = compareList.map(p => p.id).join(',');
                return `${window.location.origin}${window.location.pathname}?compare=${productIds}`;
            }

            function getShareText() {
                const names = compareList.map(p => p.model).join(' vs ');
                return `🏆 Confira minha comparação de ${names} no ComparaTop!`;
            }

            function shareToSocial(platform) {
                const url = encodeURIComponent(getShareUrl());
                const text = encodeURIComponent(getShareText());
                const title = encodeURIComponent('Comparação de Eletrodomésticos - ComparaTop');

                let shareUrl = '';

                switch (platform) {
                    case 'whatsapp':
                        shareUrl = `https://api.whatsapp.com/send?text=${text}%20${url}`;
                        break;
                    case 'telegram':
                        shareUrl = `https://t.me/share/url?url=${url}&text=${text}`;
                        break;
                    case 'facebook':
                        shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
                        break;
                    case 'twitter':
                        shareUrl = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
                        break;
                    case 'email':
                        shareUrl = `mailto:?subject=${title}&body=${text}%20${url}`;
                        break;
                    case 'copy':
                        copyToClipboard(getShareUrl());
                        return;
                }

                if (shareUrl) {
                    window.open(shareUrl, '_blank', 'width=600,height=400');
                }
            }

            function copyToClipboard(text) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast();
                }).catch(() => {
                    // Fallback
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showToast();
                });
            }

            function showToast() {
                const toast = document.getElementById('share-toast');
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 3000);
            }

            // ==================== NEWSLETTER ====================
            function subscribeNewsletter() {
                const email = document.getElementById('newsletter-email').value.trim();
                const priceAlerts = document.getElementById('nl-price').checked;
                const newComparisons = document.getElementById('nl-new').checked;
                const weeklyPromos = document.getElementById('nl-promo').checked;

                // Validate email
                if (!email || !email.includes('@')) {
                    alert('Por favor, insira um email válido.');
                    return;
                }

                // At least one preference
                if (!priceAlerts && !newComparisons && !weeklyPromos) {
                    alert('Selecione pelo menos uma preferência de comunicação.');
                    return;
                }

                // Store in localStorage (in production, would send to backend)
                const subscription = {
                    email,
                    preferences: {
                        priceAlerts,
                        newComparisons,
                        weeklyPromos
                    },
                    subscribedAt: new Date().toISOString()
                };

                // Save to localStorage
                const subscribers = JSON.parse(localStorage.getItem('comparatop_subscribers') || '[]');
                const existingIndex = subscribers.findIndex(s => s.email === email);
                if (existingIndex > -1) {
                    subscribers[existingIndex] = subscription;
                } else {
                    subscribers.push(subscription);
                }
                localStorage.setItem('comparatop_subscribers', JSON.stringify(subscribers));

                // Show success message
                document.getElementById('newsletter-form-container').style.display = 'none';
                document.getElementById('newsletter-success').style.display = 'block';

                console.log('Newsletter subscription:', subscription);
            }

            // Track channel clicks and open share link
            function trackChannel(channel) {
                const clicks = JSON.parse(localStorage.getItem('comparatop_channel_clicks') || '[]');
                clicks.push({
                    channel,
                    clickedAt: new Date().toISOString()
                });
                localStorage.setItem('comparatop_channel_clicks', JSON.stringify(clicks));
                console.log(`Channel clicked: ${channel}`);

                // Get current page URL and title for sharing
                const url = encodeURIComponent(window.location.href);
                const title = encodeURIComponent(document.title);
                const text = encodeURIComponent('Confira essa análise de produtos no ComparaTop!');

                // Open share link based on channel
                const links = {
                    whatsapp: `https://wa.me/?text=${text}%20${url}`,
                    telegram: `https://t.me/share/url?url=${url}&text=${text}`,
                    facebook: `https://www.facebook.com/sharer/sharer.php?u=${url}`,
                    instagram: `https://instagram.com`, // Instagram doesn't have direct share URL
                    email: `mailto:?subject=${title}&body=${text}%20${url}`,
                    x: `https://twitter.com/intent/tweet?url=${url}&text=${text}`,
                    twitter: `https://twitter.com/intent/tweet?url=${url}&text=${text}`
                };

                if (links[channel]) {
                    window.open(links[channel], '_blank', 'noopener,noreferrer');
                }
            }

            // ==================== PRODUCT NAVIGATION ====================
            function toggleProductGroup(element) {
                element.classList.toggle('open');
            }

            function populateProductNav() {
                // Populate Geladeiras products in nav, sorted by editorial score (highest first)
                const geladeirasList = document.getElementById('nav-geladeiras-products');
                if (geladeirasList && currentCatalog && currentCatalog.products) {
                    // Sort products by editorial score (highest first)
                    const sortedProducts = Object.values(currentCatalog.products)
                        .sort((a, b) => {
                            const scoreA = a.editorialScores?.overall || 0;
                            const scoreB = b.editorialScores?.overall || 0;
                            return scoreB - scoreA;
                        });

                    let html = '';
                    sortedProducts.forEach(p => {
                        const score = p.editorialScores?.overall || 0;
                        const scoreColor = score >= 8 ? '#22c55e' : score >= 6 ? '#eab308' : '#ef4444';
                        const altText = `Geladeira ${p.brand} ${p.model} ${p.specs?.capacidade_total || ''}L ${p.specs?.tipo || ''} Frost Free - Nota ${score}/10`;
                        // Click on name navigates; checkbox toggles compare
                        html += `<div class="nav-product-item" data-product-id="${p.id}" style="display:flex;align-items:center;gap:0.5rem;">
                        <input type="checkbox" class="nav-compare-checkbox" onclick="event.stopPropagation(); toggleSidebarCompare('${p.id}', this.parentElement)" title="Adicionar à comparação" style="cursor:pointer;width:16px;height:16px;">
                        <a href="/produto/geladeira/${p.id}" onclick="event.preventDefault(); navigateToProduct('geladeira', '${p.id}'); closeSidebar();" title="${altText}" style="flex:1;display:flex;align-items:center;gap:0.5rem;text-decoration:none;color:inherit;cursor:pointer;">
                            <img src="${p.imageUrl}" alt="${altText}" class="nav-product-item-img" onerror="this.style.display='none'" loading="lazy" width="32" height="32">
                            <span>${p.brand} ${p.model}</span>
                        </a>
                        <span class="nav-product-score" style="background:${scoreColor};color:#fff;padding:0.1rem 0.4rem;border-radius:10px;font-size:0.65rem;font-weight:600;">${score}</span>
                    </div>`;
                    });
                    geladeirasList.innerHTML = html;
                    // Update visual state for already selected products
                    updateSidebarProductStates();
                }
            }

            // Toggle compare from sidebar - adds/removes product without closing menu
            function toggleSidebarCompare(productId, element) {
                if (!currentCatalog || !currentCatalog.products) return;

                const product = currentCatalog.products[productId];
                if (!product) return;

                const score = product.editorialScores?.overall || 0;

                // Check if already in compare list
                const existingIndex = compareList.findIndex(p => p.id === productId);

                if (existingIndex >= 0) {
                    // Remove from list
                    compareList.splice(existingIndex, 1);
                    element.classList.remove('selected');
                    element.style.background = '';
                } else {
                    // Add to list (max 4)
                    if (compareList.length >= 4) {
                        alert('Máximo de 4 produtos para comparação. Remova um antes de adicionar outro.');
                        return;
                    }
                    compareList.push({
                        ...product,
                        id: productId,
                        score: score
                    });
                    element.classList.add('selected');
                    element.style.background = 'rgba(16, 185, 129, 0.15)';
                }

                // Update compare counter UI
                updateCompareUI();

                // Show compare toast
                showComparePrompt();

                // Save to localStorage for persistence
                try {
                    localStorage.setItem('compareList', JSON.stringify(compareList));
                } catch (e) { }
            }

            // Update sidebar product visual states based on compareList
            function updateSidebarProductStates() {
                const items = document.querySelectorAll('#nav-geladeiras-products .nav-product-item');
                items.forEach(item => {
                    const productId = item.dataset.productId;
                    const isSelected = compareList.some(p => p.id === productId);
                    const checkbox = item.querySelector('.nav-compare-checkbox');
                    if (isSelected) {
                        item.classList.add('selected');
                        item.style.background = 'rgba(16, 185, 129, 0.15)';
                        if (checkbox) checkbox.checked = true;
                    } else {
                        item.classList.remove('selected');
                        item.style.background = '';
                        if (checkbox) checkbox.checked = false;
                    }
                });
            }

            // Toggle score note visibility on click
            function showScoreTooltip(element) {
                const tooltip = document.getElementById('score-tooltip');
                const note = element.dataset.note;
                const color = element.dataset.color;

                if (!tooltip || !note) return;

                // Remove selected state from all
                document.querySelectorAll('.score-item-clickable').forEach(el => el.classList.remove('score-selected'));

                // If clicking same item, toggle off
                if (tooltip.style.display === 'block' && tooltip.dataset.activeId === element.dataset.note) {
                    tooltip.style.display = 'none';
                    return;
                }

                // Show tooltip with content
                element.classList.add('score-selected');
                tooltip.innerHTML = `<strong style="color:${color}">📝 Por que essa nota:</strong><br>${note}`;
                tooltip.style.borderLeftColor = color;
                tooltip.style.display = 'block';
                tooltip.dataset.activeId = note;
            }

            // Show individual product page
            let currentProduct = null;
            function showProduct(categorySlug, productId) {
                // Load catalog first if needed
                if (!currentCatalog || currentCatalog.category.slug !== categorySlug) {
                    fetch(`/data/catalogs/${categorySlug}.json`)
                        .then(r => r.json())
                        .then(data => {
                            currentCatalog = data;
                            displayProduct(productId);
                        });
                } else {
                    displayProduct(productId);
                }
            }

            function displayProduct(productId) {
                const product = currentCatalog.products[productId];
                if (!product) return;

                currentProduct = product;

                // Update nav active state
                document.querySelectorAll('.nav-product-item').forEach(el => el.classList.remove('active'));
                const navItem = document.querySelector(`.nav-product-item[data-product-id="${productId}"]`);
                if (navItem) navItem.classList.add('active');

                // Update breadcrumb
                document.getElementById('breadcrumb').innerHTML = `
                <a href="#" onclick="showHome(); return false;">Início</a> › 
                <a href="#" onclick="showCategory('${currentCatalog.category.slug}'); return false;">${currentCatalog.category.name}</a> › 
                ${product.model}
            `;
                document.getElementById('header-title').textContent = product.name;

                // Hide other pages, show product page
                document.getElementById('page-home').style.display = 'none';
                document.getElementById('page-category').style.display = 'none';
                document.getElementById('page-comparison').style.display = 'none';
                document.getElementById('page-product').style.display = 'block';

                // Update page header
                document.getElementById('product-title').textContent = `${product.brand} ${product.model}`;
                document.getElementById('product-subtitle').textContent = product.name;

                // Check if in compare list
                const isInCompare = compareList.some(p => p.id === product.id);
                const compareButtonText = isInCompare ? '✓ Na comparação' : '➕ Adicionar ao comparador';
                const compareButtonClass = isInCompare ? 'btn-compare-active' : '';

                // Get all offers sorted by price (lowest first)
                const sortedOffers = (product.offers || []).filter(o => o.price).sort((a, b) => a.price - b.price);
                const bestPrice = sortedOffers[0]?.price;

                // Calculate overall editorial score (average of scoring topics only)
                const scoringTopicIds = currentCatalog.scoringTopics?.map(t => t.id) || [];
                const editorialScoreValues = scoringTopicIds
                    .map(id => {
                        const val = product.editorialScores?.[id];
                        // Handle both old format (number) and new format (object with score)
                        return typeof val === 'object' ? val?.score : val;
                    })
                    .filter(v => typeof v === 'number');
                const overallScore = editorialScoreValues.length > 0
                    ? (editorialScoreValues.reduce((a, b) => a + b, 0) / editorialScoreValues.length)
                    : null;
                const overallScoreColor = overallScore >= 8 ? '#22c55e' : overallScore >= 6 ? '#eab308' : '#ef4444';

                // Helper to format spec labels (remove underscores)
                const formatLabel = (key) => {
                    const specDef = currentCatalog.specDefinitions?.[key];
                    if (specDef?.label) return specDef.label;
                    return key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                };

                // Pre-compute offers HTML to avoid nested template issues
                const retailerColors = {
                    'amazon': '#FF9900',
                    'mercado livre': '#FFE600',
                    'magazine luiza': '#0086FF',
                    'shopee': '#EE4D2D'
                };

                const offersHtml = sortedOffers.map((offer, idx) => {
                    const isBest = offer.price === bestPrice;
                    const retailerKey = offer.retailerName.toLowerCase();
                    const color = retailerColors[retailerKey] || '#6b7280';
                    const badgeHtml = isBest ? '<span class="offer-badge">🏆 Melhor Preço</span>' : '';
                    return `<a href="${offer.url}" target="_blank" rel="sponsored nofollow noopener" 
                           class="offer-item ${isBest ? 'offer-best' : ''}" 
                           style="border-left: 4px solid ${color};">
                            <div class="offer-retailer">
                                ${badgeHtml}
                                <span class="offer-store">${offer.retailerName}</span>
                            </div>
                            <div class="offer-price-action">
                                <span class="offer-price">${Utils.formatBRL(offer.price)}</span>
                                <span class="offer-btn-small">Ver Oferta →</span>
                            </div>
                        </a>`;
                }).join('');

                // Pre-compute specs HTML
                const specsHtml = Object.entries(product.specs || {}).map(([key, val]) => {
                    const specDef = currentCatalog.specDefinitions?.[key];
                    const label = formatLabel(key);
                    const unit = specDef?.unit || '';
                    const displayVal = (typeof val === 'boolean') ? (val ? 'Sim' : 'Não') : val;
                    return `<div class="spec-item"><span class="spec-label">${label}</span><span class="spec-value">${displayVal}${unit ? ' ' + unit : ''}</span></div>`;
                }).join('');

                // Pre-compute scores HTML with clickable items
                const scoreNotes = product.editorialScores?.notes || '';
                const scoresHtml = (currentCatalog.scoringTopics || []).map((topic, idx) => {
                    const scoreData = product.editorialScores?.[topic.id];
                    // Handle both old format (number) and new format (object with score/note)
                    const score = typeof scoreData === 'object' ? scoreData?.score : scoreData;
                    const noteText = typeof scoreData === 'object' ? scoreData?.note : topic.description;
                    if (!score) return '';
                    const color = score >= 8 ? '#22c55e' : score >= 6 ? '#eab308' : '#ef4444';
                    const finalNote = noteText || 'Avaliação baseada em análise editorial detalhada.';
                    return `<div class="score-item score-item-clickable" data-note="${finalNote.replace(/"/g, '&quot;')}" data-color="${color}" onclick="showScoreTooltip(this)" style="cursor:pointer;">
                    <span class="score-icon">${topic.icon}</span>
                    <span class="score-label">${topic.label} <span style="font-size:0.7rem;color:#94a3b8;">ⓘ</span></span>
                    <span class="score-value" style="color:${color}">${score.toFixed(1)}</span>
                </div>`;
                }).join('') + `<div id="score-tooltip" style="display:none;grid-column:1/-1;background:#f1f5f9;padding:1rem;border-radius:var(--radius-sm);margin-top:0.5rem;font-size:0.9rem;color:#475569;border-left:4px solid #3b82f6;"></div>`;

                // Pre-compute VoC HTML parts
                const prosHtml = (product.voc?.pros || []).map(p =>
                    `<li><strong>${p.topic}</strong>: ${p.detail}${p.mentions ? ` <em style="color:var(--c-muted);font-size:0.8rem;">(${p.mentions} menções)</em>` : ''}</li>`
                ).join('');

                const consHtml = (product.voc?.cons || []).map(c =>
                    `<li><strong>${c.topic}</strong>: ${c.detail}${c.mentions ? ` <em style="color:var(--c-muted);font-size:0.8rem;">(${c.mentions} menções)</em>` : ''}</li>`
                ).join('');

                const sourcesHtml = (product.voc?.sources || []).map(src =>
                    `<a href="${src.url}" target="_blank" rel="nofollow noopener" style="display:inline-flex;align-items:center;gap:0.25rem;padding:0.25rem 0.5rem;background:#e5e7eb;border-radius:var(--radius-sm);text-decoration:none;color:var(--c-text);font-size:0.8rem;">${src.name} <span style="color:var(--c-muted);">(${src.count || '~'})</span></a>`
                ).join('');

                // Pre-compute Energy Calculator HTML
                const energyCalcHtml = `
                <section class="product-section" style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:var(--radius);">
                    <div style="display:flex;align-items:center;gap:0.75rem;margin-bottom:1rem;">
                        <span style="background:linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);color:white;padding:0.5rem;border-radius:var(--radius-sm);font-size:1.25rem;">⚡</span>
                        <div>
                            <h3 style="margin:0;font-size:1.1rem;color:var(--c-primary-dark);">Calculadora de Consumo</h3>
                            <p style="margin:0;font-size:0.8rem;color:var(--c-muted);">Quanto vai custar na conta de luz?</p>
                        </div>
                    </div>
                    <div class="calculator-grid" style="display:grid;grid-template-columns:1fr auto;gap:1rem;align-items:end;">
                        <div>
                            <label style="font-size:0.85rem;font-weight:500;color:#475569;">Tarifa (R$/kWh):</label>
                            <input type="number" id="energy-tariff-${product.id}" value="0.75" step="0.01" min="0"
                                style="width:100%;padding:0.6rem;border:1px solid #cbd5e1;border-radius:var(--radius-sm);margin-top:0.25rem;font-size:0.95rem;">
                        </div>
                        <button class="btn" onclick="calculateEnergy('${product.id}', ${product.specs?.consumo_kwh || 0})"
                            style="padding:0.6rem 1.5rem;">Calcular</button>
                    </div>
                    <div id="energy-result-${product.id}" style="margin-top:1rem;display:none;"></div>
                </section>`;

                // Pre-compute Niche Calculator HTML
                const nicheCalcHtml = `
                <section class="product-section" style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:var(--radius);">
                    <div style="display:flex;align-items:center;gap:0.75rem;margin-bottom:1rem;">
                        <span style="background:linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);color:white;padding:0.5rem;border-radius:var(--radius-sm);font-size:1.25rem;">📐</span>
                        <div>
                            <h3 style="margin:0;font-size:1.1rem;color:var(--c-primary-dark);">Verificar Encaixe no Nicho</h3>
                            <p style="margin:0;font-size:0.8rem;color:var(--c-muted);">Produto: ${product.specs?.largura_cm || '?'} × ${product.specs?.altura_cm || '?'} × ${product.specs?.profundidade_cm || '?'} cm (L×A×P)</p>
                        </div>
                    </div>
                    <p style="font-size:0.85rem;color:#64748b;margin-bottom:0.75rem;">Suas medidas do nicho:</p>
                    <div class="calculator-grid" style="display:grid;grid-template-columns:repeat(3, 1fr) auto;gap:0.75rem;align-items:end;">
                        <div>
                            <label style="font-size:0.8rem;font-weight:500;color:#475569;">Largura</label>
                            <input type="number" id="niche-w-${product.id}" placeholder="${(product.specs?.largura_cm || 0) + 5}" min="0"
                                style="width:100%;padding:0.5rem;border:1px solid #cbd5e1;border-radius:var(--radius-sm);margin-top:0.25rem;font-size:0.9rem;">
                        </div>
                        <div>
                            <label style="font-size:0.8rem;font-weight:500;color:#475569;">Altura</label>
                            <input type="number" id="niche-h-${product.id}" placeholder="${(product.specs?.altura_cm || 0) + 5}" min="0"
                                style="width:100%;padding:0.5rem;border:1px solid #cbd5e1;border-radius:var(--radius-sm);margin-top:0.25rem;font-size:0.9rem;">
                        </div>
                        <div>
                            <label style="font-size:0.8rem;font-weight:500;color:#475569;">Profundidade</label>
                            <input type="number" id="niche-d-${product.id}" placeholder="${(product.specs?.profundidade_cm || 0) + 5}" min="0"
                                style="width:100%;padding:0.5rem;border:1px solid #cbd5e1;border-radius:var(--radius-sm);margin-top:0.25rem;font-size:0.9rem;">
                        </div>
                        <button class="btn" onclick="checkNicheFitSingle('${product.id}')" 
                            style="padding:0.5rem 1.25rem;">Verificar</button>
                    </div>
                    <div id="niche-result-${product.id}" style="margin-top:1rem;display:none;"></div>
                </section>`;

                // Pre-compute overall score box
                const overallScoreHtml = overallScore ? `
                <div class="overall-score-box" style="background:linear-gradient(135deg, ${overallScoreColor}20, ${overallScoreColor}10);border:2px solid ${overallScoreColor};border-radius:var(--radius);padding:1rem;margin-bottom:1rem;display:flex;align-items:center;justify-content:space-between;">
                    <div>
                        <strong style="font-size:1.1rem;color:var(--c-primary-dark);">⭐ Nota Geral</strong>
                        <p style="margin:0.25rem 0 0;color:var(--c-muted);font-size:0.85rem;">Média de ${editorialScoreValues.length} critérios avaliados</p>
                    </div>
                    <div style="font-size:2rem;font-weight:700;color:${overallScoreColor};">${overallScore.toFixed(1)}</div>
                </div>` : '';

                // Pre-compute VoC section
                let vocSectionHtml = '';
                if (product.voc) {
                    const sentimentStyle = product.voc.sentimentClass === 'positive' ? 'background:#dcfce7;color:#166534;'
                        : product.voc.sentimentClass === 'negative' ? 'background:#fee2e2;color:#991b1b;'
                            : 'background:#fef3c7;color:#92400e;';
                    const sentimentText = product.voc.sentimentClass === 'positive' ? '👍 Geralmente Positivo'
                        : product.voc.sentimentClass === 'negative' ? '👎 Geralmente Negativo'
                            : '⚖️ Misto';
                    const sampleText = product.voc.sample?.totalApprox
                        ? `<span style="color:var(--c-muted);font-size:0.85rem;">📊 Baseado em ${product.voc.sample.totalApprox.toLocaleString('pt-BR')}+ avaliações</span>`
                        : '';
                    const summary30sHtml = product.voc.summary30s ? `
                    <div class="voc-30s" style="background:#f8fafc;padding:1rem;border-radius:var(--radius-sm);margin-bottom:1rem;">
                        <h4 style="margin:0 0 0.5rem;font-size:0.9rem;">📝 Resumo em 30 segundos</h4>
                        <p style="margin:0;line-height:1.6;">${product.voc.summary30s}</p>
                    </div>` : '';
                    const sourcesSection = product.voc.sources?.length > 0 ? `
                    <div class="voc-sources" style="margin-top:1rem;padding-top:1rem;border-top:1px solid var(--c-border);">
                        <h4 style="font-size:0.85rem;color:var(--c-muted);margin-bottom:0.5rem;">📚 Fontes consultadas</h4>
                        <div style="display:flex;flex-wrap:wrap;gap:0.5rem;">${sourcesHtml}</div>
                    </div>` : '';

                    vocSectionHtml = `
                    <section class="product-section">
                        <h3>🗣️ Opinião dos Compradores</h3>
                        <div class="voc-header" style="display:flex;align-items:center;gap:1rem;margin-bottom:1rem;">
                            <span class="voc-sentiment ${product.voc.sentimentClass || 'neutral'}" style="padding:0.5rem 1rem;border-radius:var(--radius-sm);font-weight:600;${sentimentStyle}">${sentimentText}</span>
                            ${sampleText}
                        </div>
                        <p class="voc-summary">${product.voc.oneLiner}</p>
                        ${summary30sHtml}
                        <div class="voc-pros-cons">
                            <div class="voc-pros">
                                <h4>✅ Pontos Positivos</h4>
                                <ul>${prosHtml}</ul>
                            </div>
                            <div class="voc-cons">
                                <h4>⚠️ Pontos de Atenção</h4>
                                <ul>${consHtml}</ul>
                            </div>
                        </div>
                        ${sourcesSection}
                    </section>`;
                }

                // Render single product view
                let html = `
                <div class="product-detail">
                    <div class="product-detail-grid">
                        <div class="product-detail-image">
                            <img src="${product.imageUrl}" alt="${product.model}" onerror="this.style.display='none'">
                        </div>
                        <div class="product-detail-info">
                            <div class="product-detail-brand">${product.brand}</div>
                            <h2 class="product-detail-model">${product.model}</h2>
                            <p class="product-detail-name">${product.name}</p>
                            
                            <!-- All Marketplace Offers -->
                            ${sortedOffers.length > 0 ? `
                                <div class="offers-section">
                                    <h4 style="margin-bottom:0.75rem;color:var(--c-primary-dark);">💰 Onde Comprar (menor → maior preço)</h4>
                                    <div class="offers-list-vertical">
                                        ${offersHtml}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <button class="btn btn-compare-large ${compareButtonClass}" onclick="toggleProductCompare('${product.id}')" id="compare-btn-${product.id}">
                                ${compareButtonText}
                            </button>
                        </div>
                    </div>

                    <div class="product-detail-sections">
                        <!-- Specs Section -->
                        <section class="product-section">
                            <h3>📋 Especificações</h3>
                            <div class="specs-grid">
                                ${specsHtml}
                            </div>
                        </section>

                        <!-- Editorial Scores -->
                        <section class="product-section">
                            <h3>📊 Notas Editoriais</h3>
                            ${overallScoreHtml}
                            <div class="scores-grid">
                                ${scoresHtml}
                            </div>
                        </section>

                        <!-- VoC Section -->
                        ${vocSectionHtml}

                        <!-- 5-Question Quick Decision Quiz -->
                        <section class="product-section quiz-section" style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:var(--radius);">
                            <div style="display:flex;align-items:center;gap:0.75rem;margin-bottom:1rem;">
                                <span style="background:linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);color:white;padding:0.5rem;border-radius:var(--radius-sm);font-size:1.25rem;">🎯</span>
                                <div>
                                    <h3 style="margin:0;font-size:1.1rem;color:var(--c-primary-dark);">Decida em 30 Segundos</h3>
                                    <p style="margin:0;font-size:0.8rem;color:var(--c-muted);">Este produto é ideal para você?</p>
                                </div>
                            </div>
                            
                            <div id="quiz-container-${product.id}" class="quiz-container"
                                 data-product-id="${product.id}"
                                 data-capacity="${product.specs?.capacidade_total || 0}"
                                 data-freezer="${product.specs?.capacidade_freezer || 0}"
                                 data-width="${product.specs?.largura_cm || 0}"
                                 data-noise="${product.editorialScores?.ruido || 5}"
                                 data-value="${product.editorialScores?.custo_beneficio || 5}"
                                 data-best-offer="${sortedOffers[0]?.url || '#'}"
                                 data-best-price="${sortedOffers[0]?.price || 0}">
                                <div class="quiz-questions" id="quiz-questions-${product.id}"></div>
                                <div class="quiz-result" id="quiz-result-${product.id}" style="display:none;"></div>
                            </div>
                        </section>
                        ${energyCalcHtml}
                        ${nicheCalcHtml}
                    </div>
                </div>
            `;

                document.getElementById('product-content').innerHTML = html;

                // Initialize quiz for this product
                initQuiz(product.id);

                // Update SEO meta tags and Schema.org
                updateMetaTags(product);
                generateSchemaOrg(product);
            }

            // Initialize 5-question quiz for product decision
            function initQuiz(productId) {
                const container = document.getElementById(`quiz-container-${productId}`);
                if (!container) return;

                const data = container.dataset;
                const capacity = parseFloat(data.capacity) || 0;
                const freezer = parseFloat(data.freezer) || 0;
                const width = parseFloat(data.width) || 0;
                const noise = parseFloat(data.noise) || 5;
                const value = parseFloat(data.value) || 5;
                const bestOffer = data.bestOffer || '#';
                const bestPrice = parseFloat(data.bestPrice) || 0;

                const questions = [
                    {
                        q: "Qual o tamanho da sua família/quantidade de pessoas?",
                        options: ["1-2 pessoas", "3-4 pessoas", "5+ pessoas"],
                        ideal: capacity >= 400 ? [2] : [0, 1]
                    },
                    {
                        q: "Você usa muito o freezer (congela muita comida)?",
                        options: ["Pouco uso", "Uso moderado", "Uso intenso"],
                        ideal: freezer >= 100 ? [1, 2] : [0, 1]
                    },
                    {
                        q: "Qual a largura do espaço disponível (nicho)?",
                        options: ["Até 65cm", "65-75cm", "Mais de 75cm"],
                        ideal: width <= 65 ? [0, 1, 2] : width <= 72 ? [1, 2] : [2]
                    },
                    {
                        q: "Você é sensível a ruídos de eletrodomésticos?",
                        options: ["Muito sensível", "Um pouco", "Não me incomoda"],
                        ideal: noise >= 7 ? [0, 1, 2] : [1, 2]
                    },
                    {
                        q: "O que é mais importante para você?",
                        options: ["Menor preço possível", "Melhor custo-benefício", "Mais funcionalidades"],
                        ideal: value >= 8 ? [0, 1] : [1, 2]
                    }
                ];

                const userAnswers = [];
                const questionsDiv = document.getElementById(`quiz-questions-${productId}`);
                const resultDiv = document.getElementById(`quiz-result-${productId}`);

                function renderQuestions() {
                    let html = '';
                    questions.forEach((q, i) => {
                        html += `
                        <div class="quiz-question ${i === 0 ? 'active' : ''}" data-question="${i}">
                            <div class="quiz-progress">Pergunta ${i + 1} de 5</div>
                            <p class="quiz-q-text">${q.q}</p>
                            <div class="quiz-options">
                                ${q.options.map((opt, j) => `
                                    <button class="quiz-option" data-q="${i}" data-opt="${j}">${opt}</button>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    });
                    questionsDiv.innerHTML = html;

                    // Add click handlers
                    questionsDiv.querySelectorAll('.quiz-option').forEach(btn => {
                        btn.addEventListener('click', function () {
                            const qIndex = parseInt(this.dataset.q);
                            const optIndex = parseInt(this.dataset.opt);
                            selectOption(qIndex, optIndex);
                        });
                    });
                }

                function selectOption(qIndex, optIndex) {
                    userAnswers[qIndex] = optIndex;

                    const questionDiv = questionsDiv.querySelector(`[data-question="${qIndex}"]`);
                    questionDiv.querySelectorAll('.quiz-option').forEach((btn, idx) => {
                        btn.classList.toggle('selected', idx === optIndex);
                    });

                    setTimeout(() => {
                        if (qIndex < 4) {
                            questionDiv.classList.remove('active');
                            questionsDiv.querySelector(`[data-question="${qIndex + 1}"]`).classList.add('active');
                        } else {
                            showResult();
                        }
                    }, 300);
                }

                function showResult() {
                    let score = 0;
                    questions.forEach((q, i) => {
                        if (q.ideal.includes(userAnswers[i])) score++;
                    });

                    const percent = (score / 5) * 100;
                    let verdict, color, icon;

                    if (percent >= 80) {
                        verdict = 'PERFEITO para você!';
                        color = '#22c55e';
                        icon = '✅';
                    } else if (percent >= 60) {
                        verdict = 'Boa opção, vale considerar!';
                        color = '#eab308';
                        icon = '👍';
                    } else {
                        verdict = 'Talvez não seja a melhor escolha';
                        color = '#ef4444';
                        icon = '⚠️';
                    }

                    questionsDiv.style.display = 'none';
                    resultDiv.style.display = 'block';
                    resultDiv.innerHTML = `
                    <div style="text-align:center;padding:1.5rem;background:linear-gradient(135deg, ${color}20, ${color}10);border:2px solid ${color};border-radius:var(--radius);">
                        <div style="font-size:3rem;margin-bottom:0.5rem;">${icon}</div>
                        <div style="font-size:1.5rem;font-weight:700;color:${color};margin-bottom:0.5rem;">${verdict}</div>
                        <div style="font-size:1rem;color:var(--c-muted);">Compatibilidade: ${percent.toFixed(0)}% (${score}/5 critérios)</div>
                        ${percent >= 60 ? `
                            <a href="${bestOffer}" target="_blank" rel="sponsored nofollow noopener" 
                               class="btn btn-buy" style="margin-top:1rem;display:inline-block;">
                                🛒 Comprar Agora - ${Utils.formatBRL(bestPrice)}
                            </a>
                        ` : `
                            <button onclick="showCategory('geladeira');" class="btn" style="margin-top:1rem;">
                                🔍 Ver Outras Opções
                            </button>
                        `}
                        <button class="quiz-reset-btn" style="display:block;margin:1rem auto 0;background:none;border:none;color:var(--c-muted);cursor:pointer;text-decoration:underline;">
                            Refazer quiz
                        </button>
                    </div>
                `;

                    resultDiv.querySelector('.quiz-reset-btn').addEventListener('click', resetQuiz);
                }

                function resetQuiz() {
                    userAnswers.length = 0;
                    resultDiv.style.display = 'none';
                    questionsDiv.style.display = 'block';
                    questionsDiv.querySelectorAll('.quiz-question').forEach((q, i) => {
                        q.classList.toggle('active', i === 0);
                        q.querySelectorAll('.quiz-option').forEach(btn => btn.classList.remove('selected'));
                    });
                }

                renderQuestions();
            }

            // Category selector for global quiz
            document.addEventListener('DOMContentLoaded', function () {
                const categorySelect = document.getElementById('quiz-category-select');
                const startBtn = document.getElementById('start-global-quiz-btn');

                if (categorySelect && startBtn) {
                    categorySelect.addEventListener('change', function () {
                        if (this.value) {
                            startBtn.style.display = 'inline-block';
                        } else {
                            startBtn.style.display = 'none';
                        }
                    });
                }
            });

            // Global Product Recommender - ranks ALL products
            function startGlobalQuiz() {
                const categorySelect = document.getElementById('quiz-category-select');
                const selectedCategory = categorySelect ? categorySelect.value : 'geladeira';

                if (!selectedCategory) {
                    alert('Por favor, selecione uma categoria primeiro.');
                    return;
                }

                // Hide category selector during quiz
                const categorySelector = document.getElementById('quiz-category-selector');
                if (categorySelector) categorySelector.style.display = 'none';

                const catalogFile = `/data/catalogs/${selectedCategory}.json`;

                fetch(catalogFile)
                    .then(r => r.json())
                    .then(data => {
                        currentCatalog = data;
                        runGlobalQuiz(selectedCategory);
                    })
                    .catch(err => {
                        alert('Categoria ainda não disponível. Em breve!');
                        if (categorySelector) categorySelector.style.display = 'block';
                    });
            }

            function runGlobalQuiz() {
                const startBtn = document.getElementById('start-global-quiz-btn');
                const questionsDiv = document.getElementById('global-quiz-questions');
                const resultDiv = document.getElementById('global-quiz-result');

                startBtn.style.display = 'none';

                const questions = [
                    {
                        q: "Qual o tamanho da sua família/quantidade de pessoas?",
                        options: ["1-2 pessoas", "3-4 pessoas", "5+ pessoas"],
                        key: "familySize"
                    },
                    {
                        q: "Você usa muito o freezer (congela muita comida)?",
                        options: ["Pouco uso", "Uso moderado", "Uso intenso"],
                        key: "freezerUse"
                    },
                    {
                        q: "Qual a largura do espaço disponível (nicho)?",
                        options: ["Até 65cm", "65-75cm", "Mais de 75cm"],
                        key: "width"
                    },
                    {
                        q: "Você é sensível a ruídos de eletrodomésticos?",
                        options: ["Muito sensível", "Um pouco", "Não me incomoda"],
                        key: "noise"
                    },
                    {
                        q: "Qual seu orçamento máximo?",
                        options: ["Até R$ 2.500", "R$ 2.500 - 4.000", "Acima de R$ 4.000"],
                        key: "budget"
                    }
                ];

                const userAnswers = {};
                let currentQ = 0;

                function renderQuestion(index) {
                    const q = questions[index];
                    questionsDiv.innerHTML = `
                    <div class="global-quiz-question" style="background:rgba(255,255,255,0.15);padding:1.5rem;border-radius:var(--radius);">
                        <div style="font-size:0.85rem;opacity:0.8;margin-bottom:0.5rem;">Pergunta ${index + 1} de 5</div>
                        <p style="font-size:1.1rem;font-weight:600;margin-bottom:1rem;">${q.q}</p>
                        <div style="display:flex;flex-direction:column;gap:0.5rem;">
                            ${q.options.map((opt, j) => `
                                <button class="global-quiz-opt" data-opt="${j}" 
                                    style="background:rgba(255,255,255,0.9);color:#1d4ed8;padding:0.75rem 1rem;border:none;border-radius:var(--radius-sm);cursor:pointer;font-size:1rem;text-align:left;transition:all 0.2s;">
                                    ${opt}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;

                    questionsDiv.querySelectorAll('.global-quiz-opt').forEach(btn => {
                        btn.addEventListener('click', function () {
                            userAnswers[q.key] = parseInt(this.dataset.opt);
                            if (currentQ < 4) {
                                currentQ++;
                                renderQuestion(currentQ);
                            } else {
                                showGlobalResult();
                            }
                        });
                    });
                }

                function showGlobalResult() {
                    questionsDiv.style.display = 'none';
                    resultDiv.style.display = 'block';

                    // Score each product
                    const products = Object.values(currentCatalog.products);
                    const scoredProducts = products.map(p => {
                        let score = 0;
                        const specs = p.specs || {};
                        const offers = p.offers || [];
                        const lowestPrice = offers.length > 0 ? Math.min(...offers.map(o => o.price || 99999)) : 99999;

                        // Family size vs capacity
                        const capacity = specs.capacidade_total || 0;
                        if (userAnswers.familySize === 0 && capacity <= 350) score++;
                        else if (userAnswers.familySize === 1 && capacity >= 300 && capacity <= 450) score++;
                        else if (userAnswers.familySize === 2 && capacity >= 400) score++;

                        // Freezer use
                        const freezer = specs.capacidade_freezer || 0;
                        if (userAnswers.freezerUse === 0 && freezer <= 80) score++;
                        else if (userAnswers.freezerUse === 1 && freezer >= 60 && freezer <= 120) score++;
                        else if (userAnswers.freezerUse === 2 && freezer >= 100) score++;

                        // Width
                        const width = specs.largura_cm || 0;
                        if (userAnswers.width === 0 && width <= 65) score++;
                        else if (userAnswers.width === 1 && width <= 72) score++;
                        else if (userAnswers.width === 2) score++; // Any fits

                        // Noise sensitivity
                        const noiseScore = p.editorialScores?.ruido || 5;
                        if (userAnswers.noise === 0 && noiseScore >= 7) score++;
                        else if (userAnswers.noise === 1 && noiseScore >= 5) score++;
                        else if (userAnswers.noise === 2) score++; // Doesn't care

                        // Budget
                        if (userAnswers.budget === 0 && lowestPrice <= 2500) score++;
                        else if (userAnswers.budget === 1 && lowestPrice >= 2000 && lowestPrice <= 4000) score++;
                        else if (userAnswers.budget === 2 && lowestPrice >= 3000) score++;

                        return { product: p, score, percent: (score / 5) * 100, lowestPrice };
                    });

                    // Sort by score (highest first)
                    scoredProducts.sort((a, b) => b.score - a.score);

                    // Build result HTML
                    const topProducts = scoredProducts.slice(0, 3);
                    let html = `
                    <div style="background:rgba(255,255,255,0.95);padding:1.5rem;border-radius:var(--radius);color:#1e293b;">
                        <h3 style="margin:0 0 1rem;color:#1d4ed8;">🏆 Nossas Recomendações para Você</h3>
                        ${topProducts.map((item, idx) => {
                        const color = item.percent >= 80 ? '#22c55e' : item.percent >= 60 ? '#eab308' : '#ef4444';
                        const medal = idx === 0 ? '🥇' : idx === 1 ? '🥈' : '🥉';
                        const bestOffer = item.product.offers?.sort((a, b) => a.price - b.price)[0];
                        return `
                                <div style="display:flex;align-items:center;gap:1rem;padding:1rem;margin-bottom:0.5rem;background:#f8fafc;border-radius:var(--radius-sm);border-left:4px solid ${color};">
                                    <span style="font-size:1.5rem;">${medal}</span>
                                    <div style="flex:1;">
                                        <div style="font-weight:600;">${item.product.brand} ${item.product.model}</div>
                                        <div style="font-size:0.85rem;color:#64748b;">Compatibilidade: ${item.percent.toFixed(0)}% • ${Utils.formatBRL(item.lowestPrice)}</div>
                                    </div>
                                    <a href="#" onclick="showProduct('geladeira', '${item.product.id}'); return false;" 
                                        style="background:#1d4ed8;color:white;padding:0.5rem 1rem;border-radius:var(--radius-sm);text-decoration:none;font-size:0.85rem;">
                                        Ver Detalhes
                                    </a>
                                </div>
                            `;
                    }).join('')}
                        <button onclick="resetGlobalQuiz()" style="margin-top:1rem;background:none;border:none;color:#64748b;cursor:pointer;text-decoration:underline;">
                            Refazer quiz
                        </button>
                    </div>
                `;
                    resultDiv.innerHTML = html;
                }

                renderQuestion(0);
            }

            function resetGlobalQuiz() {
                const startBtn = document.getElementById('start-global-quiz-btn');
                const questionsDiv = document.getElementById('global-quiz-questions');
                const resultDiv = document.getElementById('global-quiz-result');
                const categorySelector = document.getElementById('quiz-category-selector');
                const categorySelect = document.getElementById('quiz-category-select');

                // Reset category selector
                if (categorySelector) categorySelector.style.display = 'block';
                if (categorySelect) categorySelect.value = '';

                startBtn.style.display = 'none';
                questionsDiv.style.display = 'block';
                questionsDiv.innerHTML = '';
                resultDiv.style.display = 'none';
                resultDiv.innerHTML = '';
            }

            // Toggle product in compare list from product page
            function toggleProductCompare(productId) {
                const product = currentCatalog.products[productId];
                if (!product) return;

                const existingIndex = compareList.findIndex(p => p.id === productId);
                if (existingIndex > -1) {
                    compareList.splice(existingIndex, 1);
                } else {
                    if (compareList.length < 4) {
                        compareList.push(product);
                    } else {
                        showToast('Máximo de 4 produtos na comparação');
                        return;
                    }
                }

                // Update button state
                const btn = document.getElementById(`compare-btn-${productId}`);
                if (btn) {
                    const isNowInCompare = compareList.some(p => p.id === productId);
                    btn.textContent = isNowInCompare ? '✓ Na comparação' : '➕ Adicionar ao comparador';
                    btn.classList.toggle('btn-compare-active', isNowInCompare);
                }

                updateCompareUI();
            }

            // Energy calculator for single product page
            function calculateEnergy(productId, monthlyKwh) {
                const tariff = parseFloat(document.getElementById(`energy-tariff-${productId}`).value) || 0.75;
                const monthlyCost = monthlyKwh * tariff;
                const annualCost = monthlyCost * 12;

                const resultDiv = document.getElementById(`energy-result-${productId}`);
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
        <div style="background:#f0fdf4;border:1px solid #22c55e;border-radius:var(--radius-sm);padding:1rem;">
            <div style="display:grid;grid-template-columns:repeat(2, 1fr);gap:1rem;text-align:center;">
                <div>
                    <div style="font-size:0.85rem;color:var(--c-muted);">Consumo Mensal</div>
                    <div style="font-size:1.25rem;font-weight:700;color:var(--c-primary-dark);">${monthlyKwh} kWh</div>
                </div>
                <div>
                    <div style="font-size:0.85rem;color:var(--c-muted);">Custo Mensal</div>
                    <div style="font-size:1.25rem;font-weight:700;color:var(--c-success);">
                        ${Utils.formatBRL(monthlyCost)}</div>
                </div>
                <div style="grid-column:span 2;padding-top:0.5rem;border-top:1px solid #22c55e40;">
                    <div style="font-size:0.85rem;color:var(--c-muted);">Custo Anual Estimado</div>
                    <div style="font-size:1.5rem;font-weight:700;color:var(--c-success);">${Utils.formatBRL(annualCost)}
                    </div>
                </div>
            </div>
        </div>
        `;
            }

            // Niche fit calculator for single product page
            function checkNicheFitSingle(productId) {
                const product = currentCatalog.products[productId];
                if (!product) return;

                const nicheW = parseFloat(document.getElementById(`niche-w-${productId}`).value);
                const nicheH = parseFloat(document.getElementById(`niche-h-${productId}`).value);
                const nicheD = parseFloat(document.getElementById(`niche-d-${productId}`).value);

                const prodW = product.specs?.largura_cm || 0;
                const prodH = product.specs?.altura_cm || 0;
                const prodD = product.specs?.profundidade_cm || 0;

                const gap = 4; // Recommended gap for ventilation

                const fitsW = !nicheW || (prodW + gap <= nicheW); const fitsH = !nicheH || (prodH + gap <= nicheH); const
                    fitsD = !nicheD || (prodD + gap <= nicheD); const allFit = fitsW && fitsH && fitsD; const
                        resultDiv = document.getElementById(`niche-result-${productId}`); resultDiv.style.display = 'block'; const
                            bgColor = allFit ? '#dcfce7' : '#fee2e2'; const borderColor = allFit ? '#22c55e' : '#ef4444'; const
                                icon = allFit ? '✅' : '❌'; const message = allFit ? 'O produto CABE no seu espaço!'
                                    : 'O produto NÃO CABE no espaço informado'; resultDiv.innerHTML = ` <div
            style="background:${bgColor};border:1px solid ${borderColor};border-radius:var(--radius-sm);padding:1rem;">
            <div style="font-size:1.25rem;font-weight:700;margin-bottom:0.5rem;">${icon} ${message}</div>
            <div
                style="font-size:0.9rem;display:grid;grid-template-columns:repeat(3, 1fr);gap:0.5rem;margin-top:0.75rem;">
                <div
                    style="text-align:center;padding:0.5rem;background:rgba(255,255,255,0.5);border-radius:var(--radius-sm);">
                    <div style="font-size:0.75rem;color:var(--c-muted);">Largura</div>
                    <div>${fitsW ? '✓' : '✗'} ${prodW} cm ${nicheW ? `→ ${nicheW} cm` : ''}</div>
                </div>
                <div
                    style="text-align:center;padding:0.5rem;background:rgba(255,255,255,0.5);border-radius:var(--radius-sm);">
                    <div style="font-size:0.75rem;color:var(--c-muted);">Altura</div>
                    <div>${fitsH ? '✓' : '✗'} ${prodH} cm ${nicheH ? `→ ${nicheH} cm` : ''}</div>
                </div>
                <div
                    style="text-align:center;padding:0.5rem;background:rgba(255,255,255,0.5);border-radius:var(--radius-sm);">
                    <div style="font-size:0.75rem;color:var(--c-muted);">Profundidade</div>
                    <div>${fitsD ? '✓' : '✗'} ${prodD} cm ${nicheD ? `→ ${nicheD} cm` : ''}</div>
                </div>
            </div>
            <p style="font-size:0.75rem;color:var(--c-muted);margin-top:0.5rem;">* Considerando folga mínima de ${gap}cm
                para ventilação</p>
            </div>
            `;
            }

            // Update meta tags dynamically for SEO
            function updateMetaTags(product) {
                if (!product) return;

                const title = `${product.brand} ${product.model} - Análise Completa | ComparaTop`;
                const description = `Análise ${product.name}: compare preços em ${product.offers?.length || 0} lojas, veja avaliações reais de ${product.voc?.sample?.totalApprox?.toLocaleString('pt-BR') || 'milhares'} de compradores. Nota ${product.editorialScores?.overall || 'N/A'}/10.`;

                document.title = title;

                let metaDesc = document.querySelector('meta[name="description"]');
                if (!metaDesc) {
                    metaDesc = document.createElement('meta');
                    metaDesc.name = 'description';
                    document.head.appendChild(metaDesc);
                }
                metaDesc.content = description;

                // Open Graph
                updateOrCreateMeta('og:title', title);
                updateOrCreateMeta('og:description', description);
                updateOrCreateMeta('og:url', window.location.href);
            }

            function updateOrCreateMeta(property, content) {
                let meta = document.querySelector(`meta[property="${property}"]`);
                if (!meta) {
                    meta = document.createElement('meta');
                    meta.setAttribute('property', property);
                    document.head.appendChild(meta);
                }
                meta.content = content;
            }

            // Generate Schema.org structured data for product
            function generateSchemaOrg(product) {
                if (!product) return;

                const sortedOffers = [...(product.offers || [])].sort((a, b) => a.price - b.price);
                const lowestPrice = sortedOffers[0]?.price || 0;
                const highestPrice = sortedOffers[sortedOffers.length - 1]?.price || 0;

                const schema = {
                    "@context": "https://schema.org",
                    "@type": "Product",
                    "name": `${product.brand} ${product.model}`,
                    "description": product.voc?.oneLiner || `${product.name} - Geladeira ${product.specs?.tipo || ''} ${product.specs?.capacidade_total}L`,
                    "brand": {
                        "@type": "Brand",
                        "name": product.brand
                    },
                    "sku": product.model,
                    "image": product.imageUrl,
                    "aggregateRating": {
                        "@type": "AggregateRating",
                        "ratingValue": product.editorialScores?.overall || 0,
                        "bestRating": 10,
                        "worstRating": 0,
                        "ratingCount": product.voc?.sample?.totalApprox || 1
                    },
                    "offers": {
                        "@type": "AggregateOffer",
                        "lowPrice": lowestPrice,
                        "highPrice": highestPrice,
                        "priceCurrency": "BRL",
                        "offerCount": sortedOffers.length,
                        "availability": "https://schema.org/InStock"
                    }
                };

                // Remove existing schema and add new one
                let existingSchema = document.getElementById('product-schema');
                if (existingSchema) existingSchema.remove();

                const script = document.createElement('script');
                script.id = 'product-schema';
                script.type = 'application/ld+json';
                script.textContent = JSON.stringify(schema);
                document.head.appendChild(script);
            }

            // Init - integrate router with handlers
            document.addEventListener('DOMContentLoaded', () => {
                // Load default catalog for navigation first (using absolute path)
                fetch('/data/catalogs/geladeira.json')
                    .then(r => r.json())
                    .then(data => {
                        currentCatalog = data;
                        populateProductNav();

                        // Register route handlers AFTER catalog is loaded
                        Router.on('home', () => {
                            showHome();
                            Utils.updateMetaTags({
                                title: 'ComparaTop - Compare antes de comprar',
                                description: 'Compare eletrodomésticos antes de comprar. Análise transparente com síntese de milhares de avaliações reais.',
                                url: 'https://comparatop.com.br/',
                                image: 'https://comparatop.com.br/assets/og-image.png'
                            });
                        });

                        Router.on('category', ({ categoryId }) => {
                            showCategory(categoryId);
                            const categoryNames = { geladeira: 'Geladeiras', freezer: 'Freezers', frigobar: 'Frigobares' };
                            const name = categoryNames[categoryId] || categoryId;
                            Utils.updateMetaTags({
                                title: `${name} - Compare as Melhores | ComparaTop`,
                                description: `Compare as melhores ${name.toLowerCase()} do Brasil. Análise baseada em milhares de avaliações reais.`,
                                url: `https://comparatop.com.br/categoria/${categoryId}`,
                                image: 'https://comparatop.com.br/assets/og-image.png'
                            });
                        });

                        Router.on('product', ({ categoryId, productId }) => {
                            // Load product details and render
                            showProduct(categoryId, productId);

                            // After a brief delay (for catalog to load), update meta tags
                            Catalog.load(categoryId).then(cat => {
                                const product = Catalog.getProduct(cat, productId);
                                if (product) {
                                    Utils.updateMetaTags({
                                        title: `${product.name} - Review e Preços | ComparaTop`,
                                        description: product.editorialScores?.notes || `Análise completa do ${product.name} com prós, contras e comparativo de preços.`,
                                        url: `https://comparatop.com.br/produto/${categoryId}/${productId}`,
                                        image: product.imageUrl?.startsWith('/') ? `https://comparatop.com.br${product.imageUrl}` : product.imageUrl,
                                        type: 'product'
                                    });
                                    // Inject Schema.org
                                    if (typeof injectProductSchema === 'function') {
                                        injectProductSchema(product);
                                    }
                                }
                            });
                        });

                        Router.on('comparison', () => {
                            showComparison();
                        });

                        // Initialize router (handles current URL)
                        Router.init();
                    })
                    .catch(() => {
                        // Fallback if catalog fails to load
                        Router.on('home', showHome);
                        Router.init();
                    });
            });
            // Force close sidebar on mobile load (Guardrail)
            document.addEventListener('DOMContentLoaded', () => {
                if (window.innerWidth <= 1024) {
                    closeSidebar();
                }
                // Aggressive Compare Counter Fix
                const compareCounter = document.querySelector('.compare-counter');
                if (compareCounter) {
                    if (!compareList || compareList.length === 0) {
                        compareCounter.style.display = 'none';
                    }
                }
            });

            // Ensure updateCompareUI exists and handles visibility correctly
            window.updateCompareUI = function () {
                const compareCounter = document.querySelector('.compare-counter');
                if (compareCounter) {
                    if (compareList.length > 0) {
                        compareCounter.style.display = 'flex'; // Or block/grid depending on design
                        // Update count text if needed
                        const countSpan = compareCounter.querySelector('span'); // Assuming a span holds the count
                        if (countSpan) countSpan.textContent = `${compareList.length} produto(s)`;
                    } else {
                        compareCounter.style.display = 'none';
                    }
                }
            };
        </script>
</body>

</html>
# FEEDBACK OPUS ‚Üí CHATGPT
**Timestamp:** 2026-01-22 07:59 (UTC-3)
**Executor:** Opus (Claude)
**Coordenador:** ChatGPT
**Intermedi√°rio:** Adriano

---

## ‚úÖ DIAGN√ìSTICO CIR√öRGICO CONCLU√çDO

### A) Estrutura de Cadastro de Produto

| Arquivo | Prop√≥sito |
|---------|-----------|
| `src/data/products.ts` | Array principal `ALL_PRODUCTS` (uni√£o de 6 arrays por categoria) |
| `src/lib/schemas/product.ts` | `ProductSchema` (Zod) - valida√ß√£o can√¥nica |
| `src/lib/schemas/product-intake.ts` | `ProductIntakeSchema` - intake com extens√µes por categoria |
| `src/config/product-json-schema.ts` | `ProductData` - schema para mocks JSON da PDP |
| `src/lib/product-loader.ts` | Carrega mocks de `src/data/mocks/${productId}.json` |

**Fluxo de Registro:**
```
products.ts ‚Üí ALL_PRODUCTS
                    ‚Üì
integrity-products.ts (valida contra ProductSchema)
                    ‚Üì
toProductVM() (transforma em ViewModel)
                    ‚Üì
ProductHealth (PASS/WARN/FAIL)
```

---

### B) Contratos Existentes (Resumo)

#### ProductSchema (Zod) - `src/lib/schemas/product.ts`
**OBRIGAT√ìRIOS:**
- `id` (string)
- `categoryId` (string)
- `name` (string)
- `brand` (string)
- `price` (number > 0)
- `scores` (c1-c10, cada um 0-10)

**OPCIONAIS (relevantes):**
- `attributes` ‚Üí `Record<string, string|number|boolean|string[]>` **‚Üê N√ÉO VALIDADO POR CATEGORIA**
- `technicalSpecs` ‚Üí `Record<string, any>`
- `status` ‚Üí `'draft'|'published'` (default: draft)

#### ProductIntakeSchema - `src/lib/schemas/product-intake.ts`
Usa discriminated union por `categoryId`. Extens√µes existentes:
- `tv` (screenSize, panelType, resolution, refreshRate, hdmiPorts, hasHDMI21, hasVRR)
- `fridge` (capacityLiters, doorType, hasFrostFree, hasInverter, energyClass)
- `air_conditioner` (btus, type, hasInverter, noiseDb, energyClass, voltage)
- **Demais categorias:** GenericExtensionSchema (tecnicalSpecs gen√©rico)

#### useUnifiedVoice + API /api/reviews/[productId]
Mapeia campos c1-c10 para labels **espec√≠ficos por categoria**:
| Categoria | c1 | c2 | c3 | ... |
|-----------|----|----|-----|-----|
| tv | custo_beneficio | processamento | confiabilidade | ... |
| robot-vacuum | navegacao | app_voz | mop | ... |

---

### C) Uso de `attributes` (Hard Dependencies)

**Busca:** `product.attributes?.` no c√≥digo

| Arquivo | Linha | Campo | Cr√≠tico? |
|---------|-------|-------|----------|
| `src/lib/comparison.ts` | 101 | `getAttr(product, key)` | WARN |
| `src/lib/comparison.ts` | 189-190 | `hdmi21` | WARN |

**Conclus√£o:** Componentes da PDP **N√ÉO** acessam `attributes` diretamente. Se ausente, p√°gina n√£o quebra - apenas features de compara√ß√£o/badges ficam incompletas.

---

### D) Categorias Existentes

**Total:** 52 categorias em `src/data/categories.ts`

**Com produtos cadastrados (6):**
- `tv` (SAMPLE_TVS)
- `fridge` (SAMPLE_FRIDGES)
- `air_conditioner` (SAMPLE_AIR_CONDITIONERS)
- `robot-vacuum` (SAMPLE_ROBOT_VACUUMS)
- `smartwatch` (SAMPLE_SMARTWATCHES)
- `smartphone` (SAMPLE_SMARTPHONES)

**Sem produtos:** 46 categorias

---

### E) Scripts de Integridade

| Script | Comando | Valida |
|--------|---------|--------|
| `integrity:products` | `npx tsx scripts/integrity-products.ts` | ProductSchema + slug √∫nico + categoria v√°lida + ViewModel + Health |
| `integrity:sitemap` | `npx tsx scripts/integrity-sitemap.ts` | sitemap.xml |
| `integrity:routes` | `npx tsx scripts/integrity-routes.ts` | Rotas v√°lidas |
| `integrity:links` | `npx tsx scripts/integrity-links.ts` | Links internos |
| `integrity:ui-contracts` | `npx tsx scripts/integrity-ui-contracts.ts` | Contratos UI |

**L√≥gica de Status:**
- `draft`: campos faltantes ‚Üí WARNING (n√£o bloqueia CI)
- `published`: campos faltantes ‚Üí FAIL (bloqueia CI)

---

## üéØ PROPOSTA P0 (Anti-Esquecimento)

### 1. CategoryAttributesSchema para `tv`
```
ERROR (obrigat√≥rios):
- panelType: LED|QLED|OLED|Mini-LED
- screenSize: number
- resolution: 4K|8K|FHD|HD

WARN (recomendados):
- hdmi21: boolean
- hdmi21Ports: number
- brightness: number
- refreshRate: number
- vrr: boolean
- allm: boolean
- dolbyVision: boolean
```
**Local:** `src/lib/schemas/categories/tv-attributes.ts`

### 2. CategoryAttributesSchema para `robot-vacuum`
```
ERROR (obrigat√≥rios):
- navigationType: LiDAR|VSLAM|random|gyroscope
- suctionPa: number

WARN (recomendados):
- mopType: vibrating|rotating|static|none
- hasSelfEmpty: boolean
- hasSelfWash: boolean
- batteryMah: number
- heightCm: number
- noiseLevelDb: number
- brushType: rubber|bristle|hybrid
```
**Local:** `src/lib/schemas/categories/robot-vacuum-attributes.ts`

### 3. Script `validate:product`
```bash
npm run validate:product -- --id=samsung-qn90c-65
```
Valida produto individual com output amig√°vel mostrando ERROR/WARN.

### 4. Centraliza√ß√£o de Criteria Labels
**Problema:** Labels c1-c10 est√£o em 4 lugares diferentes:
- `src/data/categories.ts` (por categoria)
- `src/config/product-json-schema.ts` (gen√©ricos TV-centric)
- `src/hooks/useUnifiedVoice.ts` (CATEGORY_FIELD_MAPS)
- `src/app/api/reviews/[productId]/route.ts` (schemas Gemini)

**Proposta:** `src/config/criteria-labels.ts` como SSOT

---

## ‚ùì QUEST√ïES PARA INTERMEDI√ÅRIO

**Nenhuma quest√£o pendente.** Diagn√≥stico completo, sem bloqueios.

---

## üìÅ ARQUIVOS GERADOS

1. `diagnostico_cirurgico_2026-01-22_0752.json` - JSON estruturado completo
2. `feedback_opus_2026-01-22_0759.md` - Este arquivo (resumo leg√≠vel)

**Pr√≥ximo passo:** ChatGPT processar este feedback e gerar prompt para implementa√ß√£o do P0.

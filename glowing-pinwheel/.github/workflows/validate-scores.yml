name: Scoring Data Integrity

on:
  push:
    branches: [main, develop]
    paths:
      - 'src/data/products*.ts'
      - 'src/lib/scoring/**'
      - 'scoring-baselines/**'
      - 'scripts/validate-scores.ts'
      - 'scripts/compare-*.ts'
  pull_request:
    branches: [main]
    paths:
      - 'src/data/products*.ts'
      - 'src/lib/scoring/**'
      - 'scoring-baselines/**'
      - 'scripts/validate-scores.ts'
      - 'scripts/compare-*.ts'

jobs:
  validate-scoring:
    name: Validate Scoring Integrity
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      # ========================================
      # SCORING INTEGRITY CHECKS
      # ========================================
      
      - name: 'ðŸ“Š Validate Scores (c1-c10 + weights)'
        run: npm run validate:scores

      - name: 'ðŸ¥‡ Compare Golden File (unifiedScore)'
        run: npm run compare:golden

      - name: 'ðŸ“ˆ Compare Score Baseline (baseScore)'
        run: npm run compare:score-baseline

      - name: 'âœ… TypeScript Check (scoring files)'
        run: npm run typecheck

# ========================================
# POLICY REMINDER (for contributors)
# ========================================
# 
# When changing DEFAULT_WEIGHTS or CATEGORY_WEIGHTS:
#   1. Bump WEIGHTS_VERSION in src/lib/scoring/category-weights.ts
#   2. Run: npm run generate:golden
#   3. Commit the new scoring-baselines/unifiedScore-vN.json
#
# Never run generate:* scripts in CI - they should only run locally.
